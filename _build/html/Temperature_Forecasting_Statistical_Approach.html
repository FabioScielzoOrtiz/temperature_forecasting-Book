
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Temperature Forecasting: Statistical Approach &#8212; Forecasting Temperature</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Temperature_Forecasting_Statistical_Approach';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Time Series Forecasting: Machine Learning Approach" href="Forecasting_Approaches.html" />
    <link rel="prev" title="Forecasting Temperature" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.avif" class="logo__image only-light" alt="Forecasting Temperature - Home"/>
    <script>document.write(`<img src="_static/logo.avif" class="logo__image only-dark" alt="Forecasting Temperature - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Forecasting Temperature
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#"><strong>Temperature Forecasting: Statistical Approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Forecasting_Approaches.html"><strong>Time Series Forecasting: Machine Learning Approach</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="PyTS_Forecasting.html"><strong>Forecasting Temperature with <code class="docutils literal notranslate"><span class="pre">PyTS</span></code></strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Skforecast_Forecasting.html"><strong>Forecasting Temperature with <code class="docutils literal notranslate"><span class="pre">Skforecast</span></code></strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Outlier_Imputation_Forecasting.html"><strong>Forecasting Temperature with Outliers Imputation</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Short_Long_Term_Forecasting.html"><strong>Short-Long Term Forecasting Approaches</strong></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/Weather-Temperature-Forecasting" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/Weather-Temperature-Forecasting/issues/new?title=Issue%20on%20page%20%2FTemperature_Forecasting_Statistical_Approach.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Temperature_Forecasting_Statistical_Approach.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Temperature Forecasting: Statistical Approach</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data"><strong>Data</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conceptual-description"><strong>Conceptual description</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-the-data"><strong>Preprocessing the data</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#yearly-temperature-time-series"><strong>yearly temperature time series</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting"><strong>Plotting</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monthly-temperature-time-series"><strong>Monthly temperature time series</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><strong>Plotting</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#daily-time-series"><strong>Daily time series</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><strong>Plotting</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forecasting-daily-temperature-humidity-and-wind-speed"><strong>Forecasting Daily Temperature, Humidity and Wind Speed</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-and-predictors-lags"><strong>Response and Predictors (lags)</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#characterizing-sarima-models"><strong>Characterizing SARIMA models</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series-decomposition"><strong>Time series decomposition</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-correlation-plots"><strong>Auto-correlation Plots</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#regular-part-p-q"><strong>Regular part <span class="math notranslate nohighlight">\((p,q)\)</span></strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-part-p-q"><strong>Seasonal part <span class="math notranslate nohighlight">\((P,Q)\)</span></strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#augmented-dickey-fuller-test"><strong>Augmented Dickey Fuller Test</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#final-specification"><strong>Final specification</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-the-models"><strong>Specifying the models</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series-train-test-split"><strong>Time Series Train-Test split</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-t"><strong>Temperature (<code class="docutils literal notranslate"><span class="pre">T</span></code>)</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-validation"><strong>Simple Validation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#predictive-visualization"><strong>Predictive visualization</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-the-best-model"><strong>Selecting the best model</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-validation"><strong>Cross Validation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id3"><strong>Selecting the best model</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id4"><strong>Predictive visualization</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-future-performance"><strong>Estimation of future performance</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#humidity-rh"><strong>Humidity (<code class="docutils literal notranslate"><span class="pre">rh</span></code>)</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5"><strong>Cross Validation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id6"><strong>Selecting the best model</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id7"><strong>Predictive visualization</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id8"><strong>Estimation of future performance</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wind-speed-wv"><strong>Wind Speed (<code class="docutils literal notranslate"><span class="pre">wv</span></code>)</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9"><strong>Cross Validation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id10"><strong>Selecting the best model</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id11"><strong>Predictive visualization</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id12"><strong>Estimation of future performance</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions"><strong>Conclusions</strong></a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="temperature-forecasting-statistical-approach">
<h1><strong>Temperature Forecasting: Statistical Approach</strong><a class="headerlink" href="#temperature-forecasting-statistical-approach" title="Link to this heading">#</a></h1>
<section id="requirements">
<h2><strong>Requirements</strong><a class="headerlink" href="#requirements" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span> 
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.seasonal</span> <span class="kn">import</span> <span class="n">STL</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The next classes and function has been developed for this project and are located in the python script <code class="docutils literal notranslate"><span class="pre">PyTS.py</span></code>, which has also been attached to the deliverable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\fscielzo\Documents\DataScience-GitHub\Time Series&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">PyTS</span> <span class="kn">import</span> <span class="n">MakeLags</span><span class="p">,</span> <span class="n">SARIMA</span><span class="p">,</span> <span class="n">SimpleExpSmooth</span><span class="p">,</span> <span class="n">LinearRegressionTS</span><span class="p">,</span> <span class="n">KNeighborsRegressorTS</span><span class="p">,</span> <span class="n">train_test_split_time_series</span><span class="p">,</span> <span class="n">predictive_time_series_plot</span><span class="p">,</span> <span class="n">KFold_score_time_series</span><span class="p">,</span> <span class="n">KFold_time_series_plot</span><span class="p">,</span> <span class="n">autoSARIMA</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data">
<h2><strong>Data</strong><a class="headerlink" href="#data" title="Link to this heading">#</a></h2>
<section id="conceptual-description">
<h3><strong>Conceptual description</strong><a class="headerlink" href="#conceptual-description" title="Link to this heading">#</a></h3>
<p>Jena Climate is weather time series dataset recorded at the Weather Station of the Max Planck Institute for Biogeochemistry in Jena, Germany.</p>
<p>This dataset is made up of 14 different quantities (such air temperature, atmospheric pressure, humidity, wind direction, and so on) were recorded every 10 minutes, over several years. This dataset covers data from January 1st 2009 to December 31st 2016.</p>
<p>The dataset can be found in <code class="docutils literal notranslate"><span class="pre">Kaggle</span></code>: <a class="reference external" href="https://www.kaggle.com/datasets/mnassrib/jena-climate">https://www.kaggle.com/datasets/mnassrib/jena-climate</a></p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Date</span> <span class="pre">Time</span></code></p></td>
<td><p>Date-time reference</p></td>
<td><p>Date</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">(mbar)</span></code></p></td>
<td><p>The pascal SI derived unit of pressure used to quantify internal pressure. Meteorological reports typically state atmospheric pressure in millibars.</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">(degC)</span></code></p></td>
<td><p>Temperature in Celsius</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Tpot</span> <span class="pre">(K)</span></code></p></td>
<td><p>Temperature in Kelvin</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Tdew</span> <span class="pre">(degC)</span></code></p></td>
<td><p>Temperature in Celsius relative to humidity. Dew Point is a measure of the absolute amount of water in the air, the DP is the temperature at which the air cannot hold all the moisture in it and water condenses.</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">rh</span> <span class="pre">(%)</span></code></p></td>
<td><p>Relative Humidity is a measure of how saturated the air is with water vapor, the %RH determines the amount of water contained within collection objects.</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">VPmax</span> <span class="pre">(mbar)</span></code></p></td>
<td><p>Saturation vapor pressure</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">VPact</span> <span class="pre">(mbar)</span></code></p></td>
<td><p>Vapor pressure</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">	VPdef</span> <span class="pre">(mbar)</span></code></p></td>
<td><p>Vapor pressure deficit</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sh</span> <span class="pre">(g/kg)</span></code></p></td>
<td><p>Specific humidity</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">H2OC</span> <span class="pre">(mmol/mol)</span></code></p></td>
<td><p>Water vapor concentration</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">rho</span> <span class="pre">(g/m</span> <span class="pre">**</span> <span class="pre">3)</span></code></p></td>
<td><p>Airtight</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">wv</span> <span class="pre">(m/s)</span></code></p></td>
<td><p>Wind speed</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">max.</span> <span class="pre">wv</span> <span class="pre">(m/s)</span></code></p></td>
<td><p>Maximum wind speed</p></td>
<td><p>quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">wd</span> <span class="pre">(deg)</span></code></p></td>
<td><p>Wind direction in degrees</p></td>
<td><p>quantitative</p></td>
</tr>
</tbody>
</table>
</section>
<section id="preprocessing-the-data">
<h3><strong>Preprocessing the data</strong><a class="headerlink" href="#preprocessing-the-data" title="Link to this heading">#</a></h3>
<p>The next peace of code read the data, rename their columns, change the date column to an appropriate date format, ad columns with the day, week, month, quarter and year of each observation and remove the last row which is the only point related with 2017.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climate_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;jena_climate_2009_2016.csv&#39;</span><span class="p">)</span>

<span class="n">climate_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;Tpot&#39;</span><span class="p">,</span> <span class="s1">&#39;Tdew&#39;</span><span class="p">,</span> <span class="s1">&#39;rh&#39;</span><span class="p">,</span> <span class="s1">&#39;VPmax&#39;</span><span class="p">,</span> <span class="s1">&#39;VPact&#39;</span><span class="p">,</span> <span class="s1">&#39;VPdef&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;sh&#39;</span><span class="p">,</span> <span class="s1">&#39;H2OC&#39;</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="s1">&#39;wv&#39;</span><span class="p">,</span> <span class="s1">&#39;max_wv&#39;</span><span class="p">,</span> <span class="s1">&#39;wd&#39;</span><span class="p">]</span>

<span class="n">climate_df</span> <span class="o">=</span> <span class="n">climate_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">to_date</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.%m.%Y %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">keep</span><span class="p">())</span>

<span class="n">climate_df</span> <span class="o">=</span> <span class="n">climate_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">climate_df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">),</span>
                        <span class="n">climate_df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">),</span>
                        <span class="n">climate_df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">),</span>
                        <span class="n">climate_df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">week</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;week&#39;</span><span class="p">),</span>
                        <span class="n">climate_df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">quarter</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;quarter&#39;</span><span class="p">))</span>

<span class="n">climate_df</span> <span class="o">=</span> <span class="n">climate_df</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="c1"># removing last row, just because is the only data point regarding 2017</span>
</pre></div>
</div>
</div>
</div>
<p>The data has 420550 rows and 20 columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climate_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(420550, 20)
</pre></div>
</div>
</div>
</div>
<p>We print a head and tail of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climate_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 20)</small><table border="1" class="dataframe"><thead><tr><th>date</th><th>p</th><th>T</th><th>Tpot</th><th>Tdew</th><th>rh</th><th>VPmax</th><th>VPact</th><th>VPdef</th><th>sh</th><th>H2OC</th><th>rho</th><th>wv</th><th>max_wv</th><th>wd</th><th>day</th><th>month</th><th>year</th><th>week</th><th>quarter</th></tr><tr><td>date</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>i8</td><td>i8</td><td>i32</td><td>i8</td><td>i8</td></tr></thead><tbody><tr><td>2009-01-01</td><td>996.52</td><td>-8.02</td><td>265.4</td><td>-8.9</td><td>93.3</td><td>3.33</td><td>3.11</td><td>0.22</td><td>1.94</td><td>3.12</td><td>1307.75</td><td>1.03</td><td>1.75</td><td>152.3</td><td>1</td><td>1</td><td>2009</td><td>1</td><td>1</td></tr><tr><td>2009-01-01</td><td>996.57</td><td>-8.41</td><td>265.01</td><td>-9.28</td><td>93.4</td><td>3.23</td><td>3.02</td><td>0.21</td><td>1.89</td><td>3.03</td><td>1309.8</td><td>0.72</td><td>1.5</td><td>136.1</td><td>1</td><td>1</td><td>2009</td><td>1</td><td>1</td></tr><tr><td>2009-01-01</td><td>996.53</td><td>-8.51</td><td>264.91</td><td>-9.31</td><td>93.9</td><td>3.21</td><td>3.01</td><td>0.2</td><td>1.88</td><td>3.02</td><td>1310.24</td><td>0.19</td><td>0.63</td><td>171.6</td><td>1</td><td>1</td><td>2009</td><td>1</td><td>1</td></tr><tr><td>2009-01-01</td><td>996.51</td><td>-8.31</td><td>265.12</td><td>-9.07</td><td>94.2</td><td>3.26</td><td>3.07</td><td>0.19</td><td>1.92</td><td>3.08</td><td>1309.19</td><td>0.34</td><td>0.5</td><td>198.0</td><td>1</td><td>1</td><td>2009</td><td>1</td><td>1</td></tr><tr><td>2009-01-01</td><td>996.51</td><td>-8.27</td><td>265.15</td><td>-9.04</td><td>94.1</td><td>3.27</td><td>3.08</td><td>0.19</td><td>1.92</td><td>3.09</td><td>1309.0</td><td>0.32</td><td>0.63</td><td>214.3</td><td>1</td><td>1</td><td>2009</td><td>1</td><td>1</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climate_df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 20)</small><table border="1" class="dataframe"><thead><tr><th>date</th><th>p</th><th>T</th><th>Tpot</th><th>Tdew</th><th>rh</th><th>VPmax</th><th>VPact</th><th>VPdef</th><th>sh</th><th>H2OC</th><th>rho</th><th>wv</th><th>max_wv</th><th>wd</th><th>day</th><th>month</th><th>year</th><th>week</th><th>quarter</th></tr><tr><td>date</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>i8</td><td>i8</td><td>i32</td><td>i8</td><td>i8</td></tr></thead><tbody><tr><td>2016-12-31</td><td>1000.11</td><td>-3.93</td><td>269.23</td><td>-8.09</td><td>72.6</td><td>4.56</td><td>3.31</td><td>1.25</td><td>2.06</td><td>3.31</td><td>1292.41</td><td>0.56</td><td>1.0</td><td>202.6</td><td>31</td><td>12</td><td>2016</td><td>52</td><td>4</td></tr><tr><td>2016-12-31</td><td>1000.07</td><td>-4.05</td><td>269.1</td><td>-8.13</td><td>73.1</td><td>4.52</td><td>3.3</td><td>1.22</td><td>2.06</td><td>3.3</td><td>1292.98</td><td>0.67</td><td>1.52</td><td>240.0</td><td>31</td><td>12</td><td>2016</td><td>52</td><td>4</td></tr><tr><td>2016-12-31</td><td>999.93</td><td>-3.35</td><td>269.81</td><td>-8.06</td><td>69.71</td><td>4.77</td><td>3.32</td><td>1.44</td><td>2.07</td><td>3.32</td><td>1289.44</td><td>1.14</td><td>1.92</td><td>234.3</td><td>31</td><td>12</td><td>2016</td><td>52</td><td>4</td></tr><tr><td>2016-12-31</td><td>999.82</td><td>-3.16</td><td>270.01</td><td>-8.21</td><td>67.91</td><td>4.84</td><td>3.28</td><td>1.55</td><td>2.05</td><td>3.28</td><td>1288.39</td><td>1.08</td><td>2.0</td><td>215.2</td><td>31</td><td>12</td><td>2016</td><td>52</td><td>4</td></tr><tr><td>2016-12-31</td><td>999.81</td><td>-4.23</td><td>268.94</td><td>-8.53</td><td>71.8</td><td>4.46</td><td>3.2</td><td>1.26</td><td>1.99</td><td>3.2</td><td>1293.56</td><td>1.49</td><td>2.16</td><td>225.8</td><td>31</td><td>12</td><td>2016</td><td>52</td><td>4</td></tr></tbody></table></div></div></div>
</div>
<p>We make a fast descriptive summary of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climate_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 21)</small><table border="1" class="dataframe"><thead><tr><th>describe</th><th>date</th><th>p</th><th>T</th><th>Tpot</th><th>Tdew</th><th>rh</th><th>VPmax</th><th>VPact</th><th>VPdef</th><th>sh</th><th>H2OC</th><th>rho</th><th>wv</th><th>max_wv</th><th>wd</th><th>day</th><th>month</th><th>year</th><th>week</th><th>quarter</th></tr><tr><td>str</td><td>str</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;count&quot;</td><td>&quot;420550&quot;</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td><td>420550.0</td></tr><tr><td>&quot;null_count&quot;</td><td>&quot;0&quot;</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><td>&quot;mean&quot;</td><td>null</td><td>989.212751</td><td>9.450181</td><td>283.492779</td><td>4.955886</td><td>76.00826</td><td>13.576273</td><td>9.533771</td><td>4.042419</td><td>6.022418</td><td>9.640238</td><td>1216.062557</td><td>1.702225</td><td>3.056558</td><td>174.743714</td><td>15.713359</td><td>6.51732</td><td>2012.496802</td><td>26.617729</td><td>2.506375</td></tr><tr><td>&quot;std&quot;</td><td>null</td><td>8.358475</td><td>8.423346</td><td>8.504449</td><td>6.730651</td><td>16.476195</td><td>7.739016</td><td>4.184158</td><td>4.896855</td><td>2.656135</td><td>4.235388</td><td>39.975064</td><td>65.446792</td><td>69.017014</td><td>86.681794</td><td>8.799074</td><td>3.448315</td><td>2.289752</td><td>15.060659</td><td>1.116766</td></tr><tr><td>&quot;min&quot;</td><td>&quot;2009-01-01&quot;</td><td>913.6</td><td>-23.01</td><td>250.6</td><td>-25.01</td><td>12.95</td><td>0.95</td><td>0.79</td><td>0.0</td><td>0.5</td><td>0.8</td><td>1059.45</td><td>-9999.0</td><td>-9999.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>2009.0</td><td>1.0</td><td>1.0</td></tr><tr><td>&quot;25%&quot;</td><td>null</td><td>984.2</td><td>3.36</td><td>277.43</td><td>0.24</td><td>65.21</td><td>7.78</td><td>6.21</td><td>0.87</td><td>3.92</td><td>6.29</td><td>1187.49</td><td>0.99</td><td>1.76</td><td>124.9</td><td>8.0</td><td>4.0</td><td>2010.0</td><td>14.0</td><td>2.0</td></tr><tr><td>&quot;50%&quot;</td><td>null</td><td>989.58</td><td>9.42</td><td>283.47</td><td>5.22</td><td>79.3</td><td>11.82</td><td>8.86</td><td>2.19</td><td>5.59</td><td>8.96</td><td>1213.79</td><td>1.76</td><td>2.96</td><td>198.1</td><td>16.0</td><td>7.0</td><td>2012.0</td><td>27.0</td><td>3.0</td></tr><tr><td>&quot;75%&quot;</td><td>null</td><td>994.72</td><td>15.47</td><td>289.53</td><td>10.07</td><td>89.4</td><td>17.6</td><td>12.35</td><td>5.3</td><td>7.8</td><td>12.49</td><td>1242.77</td><td>2.86</td><td>4.74</td><td>234.1</td><td>23.0</td><td>10.0</td><td>2014.0</td><td>40.0</td><td>4.0</td></tr><tr><td>&quot;max&quot;</td><td>&quot;2016-12-31&quot;</td><td>1015.35</td><td>37.28</td><td>311.34</td><td>23.11</td><td>100.0</td><td>63.77</td><td>28.32</td><td>46.01</td><td>18.13</td><td>28.82</td><td>1393.54</td><td>28.49</td><td>23.5</td><td>360.0</td><td>31.0</td><td>12.0</td><td>2016.0</td><td>53.0</td><td>4.0</td></tr></tbody></table></div></div></div>
</div>
<p>There is an anomaly in the variable <code class="docutils literal notranslate"><span class="pre">wv</span></code>, since the minimum value of it is -9999 when it should be a positive variable since is measure in m/s. We are going to clean this anomaly (error) substituting this value by the mean of the variable.</p>
<p>Naturally, this anomaly has been transmitted to <code class="docutils literal notranslate"><span class="pre">max_wv</span></code>, so, we will clean this variable as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climate_df</span> <span class="o">=</span> <span class="n">climate_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;wv&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;wv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
                        <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;wv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>  <span class="c1"># The replacement value for when the condition is True</span>
                        <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;wv&#39;</span><span class="p">))</span>  <span class="c1"># Keeps original value when condition is False</span>
                        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;wv&#39;</span><span class="p">)</span>  <span class="c1"># Rename the resulting column back to &#39;variable&#39;</span>
                    <span class="p">)</span>

<span class="n">climate_df</span> <span class="o">=</span> <span class="n">climate_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
                        <span class="n">pl</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;max_wv&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;max_wv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
                        <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;max_wv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>  <span class="c1"># The replacement value for when the condition is True</span>
                        <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;max_wv&#39;</span><span class="p">))</span>  <span class="c1"># Keeps original value when condition is False</span>
                        <span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;max_wv&#39;</span><span class="p">)</span>  <span class="c1"># Rename the resulting column back to &#39;variable&#39;</span>
                    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>checking if the last transformation has solved the anomaly completely.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">climate_df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 20)</small><table border="1" class="dataframe"><thead><tr><th>date</th><th>p</th><th>T</th><th>Tpot</th><th>Tdew</th><th>rh</th><th>VPmax</th><th>VPact</th><th>VPdef</th><th>sh</th><th>H2OC</th><th>rho</th><th>wv</th><th>max_wv</th><th>wd</th><th>day</th><th>month</th><th>year</th><th>week</th><th>quarter</th></tr><tr><td>date</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>i8</td><td>i8</td><td>i32</td><td>i8</td><td>i8</td></tr></thead><tbody><tr><td>2009-01-01</td><td>913.6</td><td>-23.01</td><td>250.6</td><td>-25.01</td><td>12.95</td><td>0.95</td><td>0.79</td><td>0.0</td><td>0.5</td><td>0.8</td><td>1059.45</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1</td><td>1</td><td>2009</td><td>1</td><td>1</td></tr></tbody></table></div></div></div>
</div>
<p>We can see that there are non missing values in the data, which is specially important.</p>
</section>
<section id="yearly-temperature-time-series">
<h3><strong>yearly temperature time series</strong><a class="headerlink" href="#yearly-temperature-time-series" title="Link to this heading">#</a></h3>
<p>In this section we are going to compute the yearly time series of the temperature (<code class="docutils literal notranslate"><span class="pre">T</span></code>) grouping the data bu year and aggregating with the mean.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp_year_df</span> <span class="o">=</span> <span class="n">climate_df</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp_year_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (8, 2)</small><table border="1" class="dataframe"><thead><tr><th>year</th><th>T</th></tr><tr><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;2009&quot;</td><td>8.830284</td></tr><tr><td>&quot;2010&quot;</td><td>7.504652</td></tr><tr><td>&quot;2011&quot;</td><td>9.303914</td></tr><tr><td>&quot;2012&quot;</td><td>9.655535</td></tr><tr><td>&quot;2013&quot;</td><td>9.093978</td></tr><tr><td>&quot;2014&quot;</td><td>10.718917</td></tr><tr><td>&quot;2015&quot;</td><td>10.511207</td></tr><tr><td>&quot;2016&quot;</td><td>9.988671</td></tr></tbody></table></div></div></div>
</div>
<section id="plotting">
<h4><strong>Plotting</strong><a class="headerlink" href="#plotting" title="Link to this heading">#</a></h4>
<p>We plot the this time series, first using a lineplot and secondly with a box plot for each year, overlapping the the mean for each one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_xtick</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_year_df</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">p</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_year_df</span> <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Avg.Temperature&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="c1">#ax.set_xticks(np.arange(0,max_xtick, 1))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Yearly Avg. Temperature&quot;</span><span class="p">,</span>  <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/603dbbdee0cc7dcf94d76926bb7792f13c60bbe32babb9793a94677c9c76a7b2.png" src="_images/603dbbdee0cc7dcf94d76926bb7792f13c60bbe32babb9793a94677c9c76a7b2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">years</span> <span class="o">=</span> <span class="n">climate_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mf">5.5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">climate_df</span><span class="p">,</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">)),</span> <span class="n">y</span><span class="o">=</span><span class="n">temp_year_df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Avg.Temperature&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Yearly Avg.Temperature&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3bd83d0913c013f59ed072e2439c655eee3778eaa8bc8e6eb1343108bcc5fd89.png" src="_images/3bd83d0913c013f59ed072e2439c655eee3778eaa8bc8e6eb1343108bcc5fd89.png" />
</div>
</div>
</section>
</section>
<section id="monthly-temperature-time-series">
<h3><strong>Monthly temperature time series</strong><a class="headerlink" href="#monthly-temperature-time-series" title="Link to this heading">#</a></h3>
<p>Now we compute the monthly temperature time series, grouping the temperature by year-month and aggregating by the mean.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp_month_df</span> <span class="o">=</span> <span class="n">climate_df</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">])</span>
<span class="n">temp_month_df</span> <span class="o">=</span> <span class="n">temp_month_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;month-year&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp_month_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 4)</small><table border="1" class="dataframe"><thead><tr><th>year</th><th>month</th><th>T</th><th>month-year</th></tr><tr><td>i32</td><td>i8</td><td>f64</td><td>str</td></tr></thead><tbody><tr><td>2009</td><td>1</td><td>-3.626617</td><td>&quot;1-2009&quot;</td></tr><tr><td>2009</td><td>2</td><td>0.16995</td><td>&quot;2-2009&quot;</td></tr><tr><td>2009</td><td>3</td><td>3.989944</td><td>&quot;3-2009&quot;</td></tr><tr><td>2009</td><td>4</td><td>11.889757</td><td>&quot;4-2009&quot;</td></tr><tr><td>2009</td><td>5</td><td>13.433905</td><td>&quot;5-2009&quot;</td></tr></tbody></table></div></div></div>
</div>
<section id="id1">
<h4><strong>Plotting</strong><a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<p>We plot the this time series, first using a lineplot and secondly with a box plot for each month, overlapping the the mean for each one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_xtick</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_month_df</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">p</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;month-year&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">temp_month_df</span> <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Avg.Temperature&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Month-Year&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_xtick</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Monthly Avg.Temperature&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/379e2a61df0ac0cd8f0ea6d876f9a2789c3c2e8f8ae11460d0931f1ed338266f.png" src="_images/379e2a61df0ac0cd8f0ea6d876f9a2789c3c2e8f8ae11460d0931f1ed338266f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">years</span> <span class="o">=</span> <span class="n">climate_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">n_columns</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_columns</span><span class="p">))</span>
<span class="n">min_temp</span> <span class="o">=</span> <span class="n">climate_df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">max_temp</span> <span class="o">=</span> <span class="n">climate_df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_columns</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">years</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">climate_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">),</span> 
                    <span class="n">showfliers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">temp_month_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">)[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> 
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.5</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Year </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Avg.Temperature&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_temp</span><span class="p">,</span> <span class="n">max_temp</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Monthly Avg.Temperature by Year&#39;</span><span class="p">,</span> 
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Remove any unused subplots in case the number of &#39;geo&#39; values is less than num_rows * num_cols</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">),</span> <span class="n">n_rows</span> <span class="o">*</span> <span class="n">n_columns</span><span class="p">):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f9a2ddfa08d20f97357ae95d805cee747b7a3409bd4c17ebd5e88dae5e7850f4.png" src="_images/f9a2ddfa08d20f97357ae95d805cee747b7a3409bd4c17ebd5e88dae5e7850f4.png" />
</div>
</div>
</section>
</section>
<section id="daily-time-series">
<h3><strong>Daily time series</strong><a class="headerlink" href="#daily-time-series" title="Link to this heading">#</a></h3>
<p>In this section we are going to compute the daily time series for the temperature (<code class="docutils literal notranslate"><span class="pre">T</span></code>), humidity (<code class="docutils literal notranslate"><span class="pre">rh</span></code>) and wind speed (<code class="docutils literal notranslate"><span class="pre">wv</span></code>), which are the time series we are interested in forecasting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">variables_to_forecast</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;rh&#39;</span><span class="p">,</span> <span class="s1">&#39;wv&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">climate_df</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">with_columns</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;day&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">))</span>
    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">to_date</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m-%Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">keep</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 5)</small><table border="1" class="dataframe"><thead><tr><th>year</th><th>month</th><th>day</th><th>T</th><th>date</th></tr><tr><td>i32</td><td>i8</td><td>i8</td><td>f64</td><td>date</td></tr></thead><tbody><tr><td>2009</td><td>1</td><td>1</td><td>-6.810629</td><td>2009-01-01</td></tr><tr><td>2009</td><td>1</td><td>2</td><td>-3.728194</td><td>2009-01-02</td></tr><tr><td>2009</td><td>1</td><td>3</td><td>-5.271736</td><td>2009-01-03</td></tr><tr><td>2009</td><td>1</td><td>4</td><td>-1.375208</td><td>2009-01-04</td></tr><tr><td>2009</td><td>1</td><td>5</td><td>-4.867153</td><td>2009-01-05</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 5)</small><table border="1" class="dataframe"><thead><tr><th>year</th><th>month</th><th>day</th><th>rh</th><th>date</th></tr><tr><td>i32</td><td>i8</td><td>i8</td><td>f64</td><td>date</td></tr></thead><tbody><tr><td>2009</td><td>1</td><td>1</td><td>91.086014</td><td>2009-01-01</td></tr><tr><td>2009</td><td>1</td><td>2</td><td>92.086806</td><td>2009-01-02</td></tr><tr><td>2009</td><td>1</td><td>3</td><td>76.458056</td><td>2009-01-03</td></tr><tr><td>2009</td><td>1</td><td>4</td><td>89.417361</td><td>2009-01-04</td></tr><tr><td>2009</td><td>1</td><td>5</td><td>86.260417</td><td>2009-01-05</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 5)</small><table border="1" class="dataframe"><thead><tr><th>year</th><th>month</th><th>day</th><th>wv</th><th>date</th></tr><tr><td>i32</td><td>i8</td><td>i8</td><td>f64</td><td>date</td></tr></thead><tbody><tr><td>2009</td><td>1</td><td>1</td><td>0.778601</td><td>2009-01-01</td></tr><tr><td>2009</td><td>1</td><td>2</td><td>1.419514</td><td>2009-01-02</td></tr><tr><td>2009</td><td>1</td><td>3</td><td>1.250903</td><td>2009-01-03</td></tr><tr><td>2009</td><td>1</td><td>4</td><td>1.720417</td><td>2009-01-04</td></tr><tr><td>2009</td><td>1</td><td>5</td><td>3.800278</td><td>2009-01-05</td></tr></tbody></table></div></div></div>
</div>
<section id="id2">
<h4><strong>Plotting</strong><a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<p>We plot the three time series using a lineplot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_to_forecast</span><span class="p">):</span>

    <span class="n">max_xtick</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">p</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Avg. </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="c1">#ax.set_xticks(np.linspace(0, max_xtick, 12))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Daily Avg. </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/48d6c9910114bc9b3559f842e7f943018c9af825db297bcffa53bdfcb2871526.png" src="_images/48d6c9910114bc9b3559f842e7f943018c9af825db297bcffa53bdfcb2871526.png" />
<img alt="_images/12f601d7a676e893044fb512086e51a4781988b34666a3a875d83bbbfb51296b.png" src="_images/12f601d7a676e893044fb512086e51a4781988b34666a3a875d83bbbfb51296b.png" />
<img alt="_images/cae52814e9b32c551688790e0fdb5416991a231e7250033b538be606c069ccc3.png" src="_images/cae52814e9b32c551688790e0fdb5416991a231e7250033b538be606c069ccc3.png" />
</div>
</div>
<p>We can plot boxplots for the daily temperature in a given month of a given year, in this case we will plot january, july and october of 2016 (the last year available in the data).</p>
<ul class="simple">
<li><p>Without the same y-axes scale for each row</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="mi">2016</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;turquoise&#39;</span><span class="p">,</span> <span class="s1">&#39;limegreen&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_to_forecast</span><span class="p">):</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">]):</span>

        <span class="n">n_months</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">month</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">climate_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">month</span><span class="p">),</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_months</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">month</span><span class="p">)[</span><span class="n">col</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Month - </span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Avg. </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Daily Avg. </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> - Year </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5486f0b73df7b1cd057b78ff0f1865b52ea553d8a3104c32c2bf5b368490b60c.png" src="_images/5486f0b73df7b1cd057b78ff0f1865b52ea553d8a3104c32c2bf5b368490b60c.png" />
<img alt="_images/f0a2091347c8bc9e3f8a3d96e9d4d6f2172df7d3edcdfced00912c5da969b7c2.png" src="_images/f0a2091347c8bc9e3f8a3d96e9d4d6f2172df7d3edcdfced00912c5da969b7c2.png" />
<img alt="_images/837ce07be7429e3de0dcb7f3b6b70b2eed15b186358013b28d2b1dea7a602a25.png" src="_images/837ce07be7429e3de0dcb7f3b6b70b2eed15b186358013b28d2b1dea7a602a25.png" />
</div>
</div>
<ul class="simple">
<li><p>Using the same y-axes scale for each row</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_to_forecast</span><span class="p">):</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">]):</span>

        <span class="n">n_months</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">month</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">climate_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">month</span><span class="p">),</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_months</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">year</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">month</span><span class="p">)[</span><span class="n">col</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Month </span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Avg. </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Daily Avg. </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> - Year </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7fb8be82553eb9d9861b5d6cbfeff7320ad3e20f2a73b20d8450a5b4efed904a.png" src="_images/7fb8be82553eb9d9861b5d6cbfeff7320ad3e20f2a73b20d8450a5b4efed904a.png" />
<img alt="_images/73065268dd607e6fc5aa41e8822c32c7e91dc21e3f9a6d654753596f895da9fa.png" src="_images/73065268dd607e6fc5aa41e8822c32c7e91dc21e3f9a6d654753596f895da9fa.png" />
<img alt="_images/78eb6919656fcacc48e0746f3ca3bba761cfc617f1ae6d9bad9f269a792b47f5.png" src="_images/78eb6919656fcacc48e0746f3ca3bba761cfc617f1ae6d9bad9f269a792b47f5.png" />
</div>
</div>
</section>
</section>
</section>
<section id="forecasting-daily-temperature-humidity-and-wind-speed">
<h2><strong>Forecasting Daily Temperature, Humidity and Wind Speed</strong><a class="headerlink" href="#forecasting-daily-temperature-humidity-and-wind-speed" title="Link to this heading">#</a></h2>
<p>In this section we are going to look for the best models for forecasting the daily temperature, humidity and wind speed, following an statistical approach, this means that we are not going to use more Machine Learning related tools like full automatic grid search algorithms and other ML algorithms (this will be done in the second project), and we will be also specially focus in SARIMA models, and will characterize them based on statistical techniques such as time series decomposition, correlation plots and the Dickey Fuller test.</p>
<p>Its important to notice that our main goal is to find three models for forecasting the temperature, humidity and wind speed <em><strong>15</strong></em> days in advanced.</p>
<p>We say three models because we are going to loo for the best model for forecasting each variable, but the same model could be the best for several of the variables.</p>
<p>Anyway, the main aim of the project is look for a good model but, as we commented before, without using exhaustive ML search algorithms, because this will be done in the next project. this project is more manual and statistical oriented.</p>
<section id="response-and-predictors-lags">
<h3><strong>Response and Predictors (lags)</strong><a class="headerlink" href="#response-and-predictors-lags" title="Link to this heading">#</a></h3>
<p>In time series we can use the lags of the response variable to predict it, namely, for a given date, we can use the past values of the response with respect of that date to predict it for that specific date. These past values are called lags, and the number of lags considered is a really important hyper-parameter in time series.</p>
<p>So, in time series the lags of the response play the role of predictors, even though they could not be the only predictors since other external variables could be used in the forecasting process, this is what we called multivariate time series, and it will be addressed in the second project.</p>
<p>The nex code define the response for each problem (temperature, humidity and wind speed forecasting), then, a fake predictors matrix is create for our <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> based implementations (them require that, but is only a technical detail related with how they are been characterize from a programming perspective). Afert that the code define the predictors and response for our <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>based implementations, which must incorporate the lags. In this case we have add a grid of lags, because, as we said before, they are an important hyper-parameter.</p>
<p>Its important to notice that <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> based implementations only need the original response, without lags, and a predictors matrix is not required, beyond the fake one, that is, in fact, a zero matrix, which is not used by the model at all.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span><span class="p">,</span> <span class="n">X_st</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
<span class="n">X_sk</span><span class="p">,</span> <span class="n">Y_sk</span><span class="p">,</span> <span class="n">make_lags</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">},</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">},</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">}</span>
<span class="n">lags_grid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">:</span>

    <span class="n">Y</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="c1"># Fake X for statsmodels based implementations</span>
    <span class="n">X_st</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">col</span><span class="p">]),</span> <span class="mi">4</span><span class="p">))</span>
                         
    <span class="c1"># Lagged X and Y for sklearn based implementations</span>
    <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lags_grid</span><span class="p">:</span>
        <span class="n">make_lags</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">lag</span><span class="p">]</span> <span class="o">=</span> <span class="n">MakeLags</span><span class="p">(</span><span class="n">n_lags</span><span class="o">=</span><span class="n">lag</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">make_lags</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">lag</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">X_sk</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">Y_sk</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">lag</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_lags</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">lag</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>For a better understanding we are going to display the 3-lagged response and predictors, for the temperature, gathered in a single data-frame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">make_lags</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">y_lags_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 4)</small><table border="1" class="dataframe"><thead><tr><th>Y</th><th>Y_lag_1</th><th>Y_lag_2</th><th>Y_lag_3</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>-6.810629</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><td>-3.728194</td><td>-6.810629</td><td>NaN</td><td>NaN</td></tr><tr><td>-5.271736</td><td>-3.728194</td><td>-6.810629</td><td>NaN</td></tr><tr><td>-1.375208</td><td>-5.271736</td><td>-3.728194</td><td>-6.810629</td></tr><tr><td>-4.867153</td><td>-1.375208</td><td>-5.271736</td><td>-3.728194</td></tr><tr><td>-15.482847</td><td>-4.867153</td><td>-1.375208</td><td>-5.271736</td></tr><tr><td>-15.734375</td><td>-15.482847</td><td>-4.867153</td><td>-1.375208</td></tr></tbody></table></div></div></div>
</div>
<p>The rows with <code class="docutils literal notranslate"><span class="pre">NaN</span></code> will not be used for training the models. The fourth row is the fist without <code class="docutils literal notranslate"><span class="pre">NaN</span></code>, the first column contains the original values of the response, the other columns contain the lagged response in different orders. Specifically, the second column contains the response lagged 1 period (day), the third lagged 2 days and the fourth lagged 3 days.</p>
<p>So, given a row without <code class="docutils literal notranslate"><span class="pre">NaN</span></code>, the value of the first column represents the actual value of the response (temperature in this case) in a given day, and the values of the resting columns represent the temperature in the previous three days (since there are 3 lags).</p>
<p>The idea is to use models that learn the relationship between the temperature in a given day an the one in the previous three days, and this for all the available days in a given training set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y_sk</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ -1.37520833,  -4.86715278, -15.48284722, ...,   2.67625   ,
        -1.70659722,  -2.4925    ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_sk</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-5.27173611, -3.72819444, -6.81062937],
       [-1.37520833, -5.27173611, -3.72819444],
       [-4.86715278, -1.37520833, -5.27173611],
       ...,
       [ 4.88715278,  5.245625  ,  7.52743056],
       [ 2.67625   ,  4.88715278,  5.245625  ],
       [-1.70659722,  2.67625   ,  4.88715278]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="characterizing-sarima-models">
<h3><strong>Characterizing SARIMA models</strong><a class="headerlink" href="#characterizing-sarima-models" title="Link to this heading">#</a></h3>
<section id="time-series-decomposition">
<h4><strong>Time series decomposition</strong><a class="headerlink" href="#time-series-decomposition" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">decomposition</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">:</span>
    <span class="n">decomposition</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">period</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">:</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">p1</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">decomposition</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">observed</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>
    <span class="n">p2</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">decomposition</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">trend</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;trend&#39;</span><span class="p">)</span>
    <span class="n">p3</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">decomposition</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">seasonal</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;seasonality&#39;</span><span class="p">)</span>
    <span class="n">p4</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">decomposition</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;residuals&#39;</span><span class="p">)</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Observed&#39;</span><span class="p">)</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Trend&#39;</span><span class="p">)</span>
    <span class="n">p3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Seasonality&#39;</span><span class="p">)</span>
    <span class="n">p4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;STL Decomposition - Daily Avg. </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Remove individual legends created by seaborn lineplot</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="c1"># Create a common legend for the figure</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">handle</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()):</span>
            <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/95f62569f5d43fb1dd6358efb944e0e5bc95377e877889142691b510f1056916.png" src="_images/95f62569f5d43fb1dd6358efb944e0e5bc95377e877889142691b510f1056916.png" />
<img alt="_images/077e57c7d8599b10c15c40c176446821b3699bb45edcc3bc33137170af440fc9.png" src="_images/077e57c7d8599b10c15c40c176446821b3699bb45edcc3bc33137170af440fc9.png" />
<img alt="_images/ed3445b4a9950a58e21267751528a30c49559245142f997f01c05a86ceb55175.png" src="_images/ed3445b4a9950a58e21267751528a30c49559245142f997f01c05a86ceb55175.png" />
</div>
</div>
<p>According to these plots and the ones showed before, we can extract some information regarding the trend and seasonality components of our three series in discussion.</p>
<ul class="simple">
<li><p><strong>Temperature</strong> (<code class="docutils literal notranslate"><span class="pre">T</span></code>):</p>
<ul>
<li><p><strong>Trend</strong> component: it seems that the daily temperature has non trend, since the values oscillate around a same point along the series, in other words, it has an approximately constant mean along the time. This fact tell us that a difference in the regular part will not be necessary, but, despite the plots, the will carry out an statistical test for checking this point later, the (augmented) Dickey Fuller test.</p></li>
<li><p><strong>Seasonal</strong> component: the series has a clear seasonality, which is clearly shown in the plots, and, moreover, we know that temperature is directly related to the seasons, so in this case there is no doubt. So, it seems that the series needs a difference en the seasonal part, to make it stationary in that component. The seasonality period seems to be 365 days, since the seasonal pattern seems to be repeated each 365 days.</p></li>
</ul>
</li>
<li><p><strong>Humidity</strong> (<code class="docutils literal notranslate"><span class="pre">rh</span></code>):</p>
<ul>
<li><p><strong>Trend</strong> component: it seems that the daily relative humidity has non trend, since the values oscillate around a same point along the series, in other words, it has an approximately constant mean along the time. This fact tell us that a difference in the regular part would not be necessary.</p></li>
<li><p><strong>Seasonal</strong> component: the series has a clear seasonality (although not as clear as in the temperature case), which is shown in the plots. So, it seems that the series needs a difference en the seasonal part, to make it stationary in that component. The seasonality period seems to be 365 days, since the seasonal pattern seems to be repeated each 365 days.</p></li>
</ul>
</li>
<li><p><strong>Wind speed</strong> (<code class="docutils literal notranslate"><span class="pre">wv</span></code>):</p>
<ul>
<li><p><strong>Trend</strong> component: it seems that the daily wind speed has non trend, since the values oscillate around a same point along the series, in other words, it has an approximately constant mean along the time. This fact tell us that a difference in the regular part would not be necessary.</p></li>
<li><p><strong>Seasonal</strong> component: the series has a non clear seasonality, so it seems that the series doesnt need a difference in the seasonal part. Moreover, the seasonal part of the SARIMA model wouldnt be necessary.</p></li>
</ul>
</li>
</ul>
<p>So according to the previous analysis, the suggested difference parameters for a SARIMA model would be:</p>
<ul class="simple">
<li><p><strong>Temperature</strong> (<code class="docutils literal notranslate"><span class="pre">T</span></code>):</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(d = 0\quad\)</span> (regular difference)</p></li>
<li><p><span class="math notranslate nohighlight">\(D=1, 2\quad\)</span> (seasonal difference)</p></li>
<li><p><span class="math notranslate nohighlight">\(s=365\)</span></p></li>
</ul>
</li>
<li><p><strong>Humidity</strong> (<code class="docutils literal notranslate"><span class="pre">rh</span></code>):</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(d = 0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(D=1, 2\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(s=365\)</span></p></li>
</ul>
</li>
<li><p><strong>Wind speed</strong> (<code class="docutils literal notranslate"><span class="pre">wv</span></code>):</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(d=0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(D=0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(s=0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(P,Q=0\)</span></p></li>
</ul>
</li>
</ul>
<p>As we will see later, <span class="math notranslate nohighlight">\(s=365\)</span> involves a lot of computational time with our data and the current implementation of the SARIMA model by <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>. Due to that we will have to set a much lower different values,  just to train the models in a reasonable time, even though we known that those values of <span class="math notranslate nohighlight">\(s\)</span> will not be the most suitable at all from a theoretical perspective, but are much more efficient computationally.</p>
</section>
<section id="auto-correlation-plots">
<h4><strong>Auto-correlation Plots</strong><a class="headerlink" href="#auto-correlation-plots" title="Link to this heading">#</a></h4>
<section id="regular-part-p-q">
<h5><strong>Regular part <span class="math notranslate nohighlight">\((p,q)\)</span></strong><a class="headerlink" href="#regular-part-p-q" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_to_forecast</span><span class="p">):</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plot_acf</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plot_pacf</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> 
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Daily Avg. </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> - Correlation Plots&#39;</span><span class="p">,</span> 
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/de5553c87e257e6f4ddbd603af5a9b9a9cb65ecbc00fb6c74c02f0d9a3c5b88e.png" src="_images/de5553c87e257e6f4ddbd603af5a9b9a9cb65ecbc00fb6c74c02f0d9a3c5b88e.png" />
<img alt="_images/68714e7daabe3c529e675b6528660f97ea0f8a79ba956599816dbd961d62399d.png" src="_images/68714e7daabe3c529e675b6528660f97ea0f8a79ba956599816dbd961d62399d.png" />
<img alt="_images/289a052d1975dbedef8f302d22d958a6add52cf4a16b6a57613ce5e9316d0bbf.png" src="_images/289a052d1975dbedef8f302d22d958a6add52cf4a16b6a57613ce5e9316d0bbf.png" />
</div>
</div>
<p>According to these correlation plots we can guess the parameters <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(q\)</span> of the SARIMA model.</p>
<ul class="simple">
<li><p><strong>Temperature</strong> (<code class="docutils literal notranslate"><span class="pre">T</span></code>):</p>
<ul>
<li><p><strong>ACP:</strong> the ACP shows a clear (maybe geometric) descending structure, which is common in a AR (auto-regressive) process.</p></li>
<li><p><strong>PACP:</strong> the PACP shows that the first two partial-auto-correlations are non-zero significative while the rest not.</p></li>
<li><p><strong>Conclusion:</strong> tis series fits with an AR process of order two <span class="math notranslate nohighlight">\(\Rightarrow p=2\)</span> , <span class="math notranslate nohighlight">\(q=0\)</span>.</p></li>
</ul>
</li>
<li><p><strong>Humidity</strong> (<code class="docutils literal notranslate"><span class="pre">rh</span></code>):</p>
<ul>
<li><p><strong>ACP:</strong> the ACP shows a clear (geometric) descending structure, which is common in a AR (auto-regressive) process.</p></li>
<li><p><strong>PACP:</strong> the PACP shows that the first two partial auto correlations are non-zero significative while the rest not. But the second value is less significant than in the temperature series.</p></li>
<li><p><strong>Conclusion:</strong> tis series fits with an AR process of order two, but it may also be of order one <span class="math notranslate nohighlight">\(\Rightarrow p=1,2\)</span> , <span class="math notranslate nohighlight">\(q=0\)</span>.</p></li>
</ul>
</li>
<li><p><strong>Wind speed</strong> (<code class="docutils literal notranslate"><span class="pre">wv</span></code>):</p>
<ul>
<li><p><strong>ACP:</strong> the ACP shows a very fast (geometric) descending structure, which is common in AR processes.</p></li>
<li><p><strong>PACP:</strong> the PACP shows that the first partial auto correlations is non-zero significative while the rest not (although the second one could be significative as well).</p></li>
<li><p><strong>Conclusion:</strong> tis series fits with an AR process of order two, but it may also be of order one <span class="math notranslate nohighlight">\(\Rightarrow p=1,2\)</span> , <span class="math notranslate nohighlight">\(q=0\)</span>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="seasonal-part-p-q">
<h5><strong>Seasonal part <span class="math notranslate nohighlight">\((P,Q)\)</span></strong><a class="headerlink" href="#seasonal-part-p-q" title="Link to this heading">#</a></h5>
<p>We are going to apply a seasonal difference to the variables which show a seasonal component, namely, temperature and humidity, as we discussed before.</p>
<p>After that, we will plot the auto correlation plots for both, in order to identify or guess values for the parameters <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(Q\)</span>, the order of the AR and MA processes in the seasonal part of  the SARIMA model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y_seasonal_diff</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">variables_with_seasonality</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;rh&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_with_seasonality</span><span class="p">:</span>
    <span class="n">Y_seasonal_diff</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">col</span><span class="p">])</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_with_seasonality</span><span class="p">):</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plot_acf</span><span class="p">(</span><span class="n">Y_seasonal_diff</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plot_pacf</span><span class="p">(</span><span class="n">Y_seasonal_diff</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> 
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Daily Avg. </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> - Correlation Plots&#39;</span><span class="p">,</span> 
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/acb798f12b01fdd3557073615dc1fb9bfcd557f05d3a45ce9d5ead0f9d90ceea.png" src="_images/acb798f12b01fdd3557073615dc1fb9bfcd557f05d3a45ce9d5ead0f9d90ceea.png" />
<img alt="_images/dcf05b1c312ac7510e90c8f740d55e7ad764adbb6fbc31dd38f6bab7e0c5f5d9.png" src="_images/dcf05b1c312ac7510e90c8f740d55e7ad764adbb6fbc31dd38f6bab7e0c5f5d9.png" />
</div>
</div>
<p>According to these correlation plots we can guess the parameters <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(Q\)</span> of the SARIMA model.</p>
<ul class="simple">
<li><p><strong>Temperature</strong> (<code class="docutils literal notranslate"><span class="pre">T</span></code>):</p>
<ul>
<li><p><strong>ACP:</strong> the ACP shows a clear (maybe geometric) descending structure, which is common in a AR (auto-regressive) process.</p></li>
<li><p><strong>PACP:</strong> the PACP shows that the first two partial-auto-correlations are non-zero significative while the rest not, although it could be interpreted as well that only the first one is clearly significative.</p></li>
<li><p><strong>Conclusion:</strong> this series fits with an AR process of order one or two in the seasonal part <span class="math notranslate nohighlight">\(\Rightarrow P=1,2\)</span> , <span class="math notranslate nohighlight">\(Q=0\)</span>.</p></li>
</ul>
</li>
<li><p><strong>Humidity</strong> (<code class="docutils literal notranslate"><span class="pre">rh</span></code>):</p>
<ul>
<li><p><strong>ACP:</strong> the ACP shows a clear (geometric) descending structure, which is common in a AR (auto-regressive) process.</p></li>
<li><p><strong>PACP:</strong> the PACP shows that the first partial auto correlation is non-zero significative while the rest not. Although the second one could be considered as significative as well.</p></li>
<li><p><strong>Conclusion:</strong> this series fits with an AR process of order one or two <span class="math notranslate nohighlight">\(\Rightarrow P=1,2\)</span> , <span class="math notranslate nohighlight">\(Q=0\)</span>.</p></li>
</ul>
</li>
<li><p><strong>Wind speed</strong> (<code class="docutils literal notranslate"><span class="pre">wv</span></code>):</p>
<ul>
<li><p>As we saw before, the daily wind speed has not clear seasonality, so that <span class="math notranslate nohighlight">\(P=Q=0\)</span>.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="augmented-dickey-fuller-test">
<h4><strong>Augmented Dickey Fuller Test</strong><a class="headerlink" href="#augmented-dickey-fuller-test" title="Link to this heading">#</a></h4>
<p>In this section we are going to carry out the augmented dickey fuller test for the three original series. This test has as null hypothesis <span class="math notranslate nohighlight">\((H_0)\)</span> that the series has non significative trend, so, is likely stationary in the regular part, and as alternative hypothesis the opposite. So, reject <span class="math notranslate nohighlight">\(H_0\)</span> means that our series has significative trend and, therefore, needs (at least) one regular difference. And not reject <span class="math notranslate nohighlight">\(H_0\)</span> means that our series is stationary in mean, that is, it doesnt show a clear trend, so, a difference in the regular part will not be needed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------------------------------------------------------------------------------------------------------------------------------------&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">:</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">test_statistic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">p_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test Statistic the time series </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">test_statistic</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;p-value for the time series </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">p_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="k">if</span> <span class="n">p_value</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reject the H0 --&gt; The time series </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> seems stationary (non significative trend) --&gt; The series doesn</span><span class="se">\&#39;</span><span class="s1">t need a regular difference&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Not reject H0 --&gt; The time series </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> seems non-stationary (significative trend)  --&gt; The series needs a regular difference&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------------------------------------------------------------------------------------------------------------------------------------&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------------------------------------------------------------------------------------------
Test Statistic the time series T: -3.614
p-value for the time series T: 0.005
Reject the H0 --&gt; The time series T seems stationary (non significative trend) --&gt; The series doesn&#39;t need a regular difference
------------------------------------------------------------------------------------------------------------------------------------------------
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test Statistic the time series rh: -5.619
p-value for the time series rh: 0.0
Reject the H0 --&gt; The time series rh seems stationary (non significative trend) --&gt; The series doesn&#39;t need a regular difference
------------------------------------------------------------------------------------------------------------------------------------------------
Test Statistic the time series wv: -14.456
p-value for the time series wv: 0.0
Reject the H0 --&gt; The time series wv seems stationary (non significative trend) --&gt; The series doesn&#39;t need a regular difference
------------------------------------------------------------------------------------------------------------------------------------------------
</pre></div>
</div>
</div>
</div>
<p>As we deduced before, the three series has non significative trend, so a regular difference is not needed for them <span class="math notranslate nohighlight">\((d=0)\)</span>.</p>
</section>
<section id="final-specification">
<h4><strong>Final specification</strong><a class="headerlink" href="#final-specification" title="Link to this heading">#</a></h4>
<p>So, summarizing these are the suggested SARIMA models for each time series, according to the previous analysis:</p>
<ul class="simple">
<li><p><strong>Temperature</strong> (<code class="docutils literal notranslate"><span class="pre">T</span></code>): <span class="math notranslate nohighlight">\(\quad(p=2, d=0, q=0)\times (P=1,2 , D=1,2, Q=0)_{s=365}\)</span></p></li>
<li><p><strong>Humidity</strong> (<code class="docutils literal notranslate"><span class="pre">rh</span></code>): <span class="math notranslate nohighlight">\(\quad (p=1,2, d=0, q=0)\times (P=1,2 , D=1,2, Q=0)_{s=365}\)</span></p></li>
<li><p><strong>Wind speed</strong> (<code class="docutils literal notranslate"><span class="pre">wv</span></code>): <span class="math notranslate nohighlight">\(\quad (p=1,2, d=0, q=0)\times (P=0 , D=0, Q=0)_{s=0}\)</span></p></li>
</ul>
</section>
</section>
<section id="specifying-the-models">
<h3><strong>Specifying the models</strong><a class="headerlink" href="#specifying-the-models" title="Link to this heading">#</a></h3>
<p>In this section we are going to define the models taht we are going to use.</p>
<p>In one hand the ones based on <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> implementations, essentially SARIMA and exponential smoothing. On the other hand the ones based on <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>implementations, basically Linear Regression and KNN.</p>
<p>In this project we have decided not to go further in the <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> models just because we want to take much more advantage of them in the next project, since are more related with the Machine Learning approach that will inspire that second project.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> based implementations:</p>
<p>Here we specify several SARIMA models based on the above section analysis.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sarima</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span> <span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">}</span>
<span class="n">exp_smooth</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<p>As we said before, we are not going to set <span class="math notranslate nohighlight">\(s=365\)</span> due to it is computational too expensive, but it would be the best option, at least in theory. However we are forced to set lower values to run the models in a reasonable time.</p>
<ul class="simple">
<li><p>SARIMA specification for Temperature:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>SARIMA specification for Humidity:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;rh&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;rh&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;rh&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;rh&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;rh&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;rh&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;rh&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;rh&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>SARIMA specification for Wind Speed:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;wv&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;wv&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;wv&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;wv&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;wv&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
<span class="n">sarima</span><span class="p">[</span><span class="s1">&#39;wv&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">SARIMA</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Simple Exponential Smoothing specification: (the same ones for each variable)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp_smooth</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SimpleExpSmooth</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">exp_smooth</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">SimpleExpSmooth</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">exp_smooth</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">SimpleExpSmooth</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">exp_smooth</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">SimpleExpSmooth</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We define a dictionary with the models specified for each variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">st_models</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">:</span>

    <span class="n">st_models_values</span> <span class="o">=</span>  <span class="p">[</span><span class="n">sarima</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sarima</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">+</span> <span class="p">[</span><span class="n">exp_smooth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">exp_smooth</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>                 

    <span class="n">st_model_keys</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">sarima</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sarima</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">exp_smooth</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">exp_smooth</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

    <span class="n">st_models</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">st_model_keys</span><span class="p">,</span> <span class="n">st_models_values</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> based implementations:</p>
<p>We define tha <code class="docutils literal notranslate"><span class="pre">sklear</span></code> based models that we will try in this project (in the next much more sklearn implementations will be tried).</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linear_regression</span> <span class="o">=</span> <span class="n">LinearRegressionTS</span><span class="p">()</span>
<span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsRegressorTS</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>As before, we define a dictionary with the sklearn models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sk_models_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">linear_regression</span><span class="p">,</span> <span class="n">knn</span><span class="p">]</span>

<span class="n">sk_models_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Linear Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;knn&#39;</span><span class="p">]</span>

<span class="n">sk_models</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sk_models_keys</span><span class="p">,</span> <span class="n">sk_models_values</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-series-train-test-split">
<h3><strong>Time Series Train-Test split</strong><a class="headerlink" href="#time-series-train-test-split" title="Link to this heading">#</a></h3>
<p>We are going to use train-test split for the outer evaluation, that is, for the estimation of future performance.</p>
<p>First we fix both the test and forecast window, that is, the number of days that will define the testing and forecasting period. We have decided to fix them equally.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_window</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">forecast_window</span> <span class="o">=</span> <span class="mi">15</span>
</pre></div>
</div>
</div>
</div>
<ul>
<li><p>For the <code class="docutils literal notranslate"><span class="pre">statmodels</span></code> implementations:</p>
<p>We define the train-test split, one for each variable.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_st</span><span class="p">,</span> <span class="n">X_test_st</span><span class="p">,</span> <span class="n">Y_train_st</span><span class="p">,</span> <span class="n">Y_test_st</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">:</span>
    
    <span class="n">X_train_st</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">X_test_st</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">Y_train_st</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">Y_test_st</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_test_split_time_series</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_st</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul>
<li><p>For the <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> implementations:</p>
<p>We define the train-test split, one for each variable and lag considered.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_sk</span><span class="p">,</span> <span class="n">X_test_sk</span><span class="p">,</span> <span class="n">Y_train_sk</span><span class="p">,</span> <span class="n">Y_test_sk</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">},</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">},</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">},</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">}</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">variables_to_forecast</span><span class="p">:</span>

    <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lags_grid</span><span class="p">:</span>

        <span class="n">X_train_sk</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">X_test_sk</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">Y_train_sk</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">Y_test_sk</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">lag</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_test_split_time_series</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_sk</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_sk</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="temperature-t">
<h3><strong>Temperature (<code class="docutils literal notranslate"><span class="pre">T</span></code>)</strong><a class="headerlink" href="#temperature-t" title="Link to this heading">#</a></h3>
<section id="simple-validation">
<h4><strong>Simple Validation</strong><a class="headerlink" href="#simple-validation" title="Link to this heading">#</a></h4>
<p>In this section we are going to use simple validation as inner evaluation method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y_hat</span><span class="p">,</span> <span class="n">Y_test_hat</span><span class="p">,</span> <span class="n">Y_future_hat</span><span class="p">,</span> <span class="n">scores</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<ul>
<li><p>For <code class="docutils literal notranslate"><span class="pre">statmodels</span></code> based implementations</p>
<p>We applied simple validation to the statsmodels models for computing their inner score (error) in the validation set, as well as we use them to forecast the future (the next days, starting form the last date in our available date), because we will to show this info in a plot as well.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Train-train - Train-validate split</span>
<span class="n">X_train2</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">Y_train2</span><span class="p">,</span> <span class="n">Y_val</span> <span class="o">=</span> <span class="n">train_test_split_time_series</span><span class="p">(</span><span class="n">X_train_st</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">Y_train_st</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">st_models</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">st_models</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Forecasting the past </span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Y_train2</span><span class="p">)</span>
    <span class="n">Y_test_hat</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">test_window</span><span class="p">)</span> 
    <span class="n">scores</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">y_true</span><span class="o">=</span><span class="n">Y_val</span><span class="p">)</span>
    
    <span class="c1"># Forecasting the future</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
    <span class="n">Y_future_hat</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">forecast_window</span><span class="p">)</span>   

    <span class="n">Y_hat</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Y_test_hat</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">Y_future_hat</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SARIMA(D=1, P=1, p=2, s=7)
SARIMA(D=1, P=2, p=2, s=7)
SARIMA(D=2, P=2, p=2, s=7)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SARIMA(D=2, P=1, p=2, s=7)
SARIMA(D=1, P=1, p=2, s=14)
SARIMA(D=1, P=1, p=2, s=30)
SimpleExpSmooth(smoothing_level=0.05)
SimpleExpSmooth(smoothing_level=0.5)
SimpleExpSmooth(smoothing_level=0.8)
SimpleExpSmooth(smoothing_level=1.5)
</pre></div>
</div>
</div>
</div>
<ul>
<li><p>For <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> based implementations</p>
<p>We applied simple validation to the sklearn models to compute their inner score (error) in the validation set, as well as we use them to forecast the future (the next days, starting form the last date in our available date), because we will to show this info in a plot as well.</p>
<p>In this case we train each model with each one of the considered lags, since sklearn implementations takes the lags of the response as predictors, and the lags play an important role in the forecasting process, so, is an important hyperparameter, therefore is important to explore different lags. In this project we are not going to do this exploration in the most suitable way, since we are not applying a standard grid search algorithm, but we will try at least several values, just to see that they are really import for the final forecasting results.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lags_grid</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span>

    <span class="c1"># Train-train - Train-validate split</span>
    <span class="n">X_train2</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">Y_train2</span><span class="p">,</span> <span class="n">Y_val</span> <span class="o">=</span> <span class="n">train_test_split_time_series</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train_sk</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_sk</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sk_models</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">sk_models</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Forecasting the past </span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train2</span><span class="p">)</span>
        <span class="n">Y_test_hat</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">test_window</span><span class="p">)</span> 
        <span class="n">scores</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">],</span> <span class="n">y_true</span><span class="o">=</span><span class="n">Y_val</span><span class="p">)</span>
        
        <span class="c1"># Forecasting the future</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_sk</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_sk</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">lag</span><span class="p">])</span>
        <span class="n">Y_future_hat</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">forecast_window</span><span class="p">)</span>   

        <span class="n">Y_hat</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Y_test_hat</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">],</span> <span class="n">Y_future_hat</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
Linear Regression
knn
2
Linear Regression
knn
3
Linear Regression
knn
7
Linear Regression
knn
10
Linear Regression
knn
20
Linear Regression
knn
30
Linear Regression
knn
40
Linear Regression
knn
</pre></div>
</div>
</div>
</div>
<ul>
<li><p>For <code class="docutils literal notranslate"><span class="pre">pmdarima</span></code>implementation</p>
<p>Here we apply simple validation to the auto SARIMA implementation of the library <code class="docutils literal notranslate"><span class="pre">pmdarima</span></code>. This implementation applies a sort of grid search on the SARIMA model.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Auto SARIMA&#39;</span>

<span class="n">auto_sarima</span> <span class="o">=</span> <span class="n">autoSARIMA</span><span class="p">(</span><span class="n">seasonal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                         <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Train-train - Train-validate split</span>
<span class="n">X_train2</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">Y_train2</span><span class="p">,</span> <span class="n">Y_val</span> <span class="o">=</span> <span class="n">train_test_split_time_series</span><span class="p">(</span><span class="n">X_train_st</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">Y_train_st</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">)</span>

<span class="c1"># Forecasting the past </span>
<span class="n">auto_sarima</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Y_train2</span><span class="p">)</span>
<span class="n">Y_test_hat</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">auto_sarima</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">test_window</span><span class="p">)</span> 
<span class="n">scores</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">y_true</span><span class="o">=</span><span class="n">Y_val</span><span class="p">)</span>

<span class="c1"># Forecasting the future</span>
<span class="n">auto_sarima</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
<span class="n">Y_future_hat</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">auto_sarima</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">forecast_window</span><span class="p">)</span>   

<span class="n">Y_hat</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Y_test_hat</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">Y_future_hat</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing stepwise search to minimize aic
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=17027.082, Time=0.83 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=17617.318, Time=0.05 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=14221.414, Time=0.66 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=14894.322, Time=1.00 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=17615.365, Time=0.04 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=14936.976, Time=0.12 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=13830.799, Time=1.75 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=7.60 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=2.83 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=17009.228, Time=1.10 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=13723.824, Time=2.40 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=14082.336, Time=0.93 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=9.43 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=4.00 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=13708.734, Time=3.05 sec
 ARIMA(3,0,0)(1,1,0)[7] intercept   : AIC=14076.852, Time=1.13 sec
 ARIMA(3,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=10.88 sec
 ARIMA(3,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=4.96 sec
 ARIMA(3,0,1)(2,1,0)[7] intercept   : AIC=13710.524, Time=5.82 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=13710.062, Time=3.63 sec
 ARIMA(3,0,0)(2,1,0)[7]             : AIC=13706.776, Time=0.90 sec
 ARIMA(3,0,0)(1,1,0)[7]             : AIC=14074.882, Time=0.50 sec
 ARIMA(3,0,0)(2,1,1)[7]             : AIC=inf, Time=5.23 sec
 ARIMA(3,0,0)(1,1,1)[7]             : AIC=inf, Time=2.30 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=13721.873, Time=0.74 sec
 ARIMA(3,0,1)(2,1,0)[7]             : AIC=13708.565, Time=1.68 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=13708.107, Time=1.11 sec

Best model:  ARIMA(3,0,0)(2,1,0)[7]          
Total fit time: 74.689 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=17203.779, Time=0.72 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=17805.774, Time=0.05 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=14366.839, Time=0.63 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=15045.405, Time=1.00 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=17803.852, Time=0.03 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=15095.058, Time=0.12 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=13975.896, Time=1.86 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=6.81 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=3.40 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=17184.371, Time=1.32 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=13862.739, Time=2.47 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=14221.576, Time=0.92 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=9.20 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=3.90 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=13847.801, Time=3.03 sec
 ARIMA(3,0,0)(1,1,0)[7] intercept   : AIC=14216.183, Time=1.09 sec
 ARIMA(3,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=10.96 sec
 ARIMA(3,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=5.55 sec
 ARIMA(3,0,1)(2,1,0)[7] intercept   : AIC=13849.551, Time=5.15 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=13849.231, Time=3.97 sec
 ARIMA(3,0,0)(2,1,0)[7]             : AIC=13845.827, Time=0.87 sec
 ARIMA(3,0,0)(1,1,0)[7]             : AIC=14214.208, Time=0.39 sec
 ARIMA(3,0,0)(2,1,1)[7]             : AIC=inf, Time=4.13 sec
 ARIMA(3,0,0)(1,1,1)[7]             : AIC=inf, Time=2.20 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=13860.769, Time=0.68 sec
 ARIMA(3,0,1)(2,1,0)[7]             : AIC=13847.576, Time=1.87 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=13847.258, Time=1.14 sec

Best model:  ARIMA(3,0,0)(2,1,0)[7]          
Total fit time: 73.484 seconds
</pre></div>
</div>
</div>
</div>
<p>We generate variables with the dates associates to the testing and forecasting period, since we need them for plotting proposes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dates</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># Test dates</span>
<span class="n">test_dates</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="o">-</span> <span class="n">test_window</span><span class="p">):]</span>
<span class="n">test_dates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">test_dates</span><span class="p">)</span>
<span class="n">test_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">test_dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_dates</span><span class="p">))]</span>

<span class="c1"># Forecast dates</span>
<span class="n">forecasting_dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">last_date</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">forecast_window</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">forecasting_dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># An equivalent way to extract the prediction dates</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">prediction_dates = []</span>
<span class="sd">given_date = temp_day_df[&#39;date&#39;][len(temp_day_df) - test_window - 1]</span>
<span class="sd">for i in range(1, test_window + forecast_window + 1):</span>
<span class="sd">    prediction_dates.append(given_date + timedelta(days=i))</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;\nprediction_dates = []\ngiven_date = temp_day_df[&#39;date&#39;][len(temp_day_df) - test_window - 1]\nfor i in range(1, test_window + forecast_window + 1):\n    prediction_dates.append(given_date + timedelta(days=i))\n&quot;
</pre></div>
</div>
</div>
</div>
<section id="predictive-visualization">
<h5><strong>Predictive visualization</strong><a class="headerlink" href="#predictive-visualization" title="Link to this heading">#</a></h5>
<p>The following plot is an smart visualization of how each tried model predicts the testing set and forecast the future, using the same test and forecast window (15 days).</p>
<p>Its important to notice that our main aim uis to find a good model for forecasting the temperature 15 days in advanced.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting test and future forecast</span>

<span class="n">predicted_values</span> <span class="o">=</span> <span class="n">Y_hat</span>
<span class="n">prediction_dates</span> <span class="o">=</span> <span class="n">test_dates</span> <span class="o">+</span> <span class="n">forecasting_dates</span>

<span class="n">predictive_time_series_plot</span><span class="p">(</span><span class="n">n_cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> 
                            <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">2016</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">is_in</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">])),</span> 
                            <span class="n">x_name</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">y_name</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">true_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">pred_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                            <span class="n">predicted_values</span><span class="o">=</span><span class="n">predicted_values</span><span class="p">,</span> <span class="n">prediction_dates</span><span class="o">=</span><span class="n">prediction_dates</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> <span class="n">scores</span><span class="o">=</span><span class="n">scores</span><span class="p">,</span> <span class="n">score_name</span><span class="o">=</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Forecasting Daily Avg. Temperature (C) - Forecast window of </span><span class="si">{</span><span class="n">forecast_window</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">,</span> 
                            <span class="n">title_size</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">title_weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">subtitles_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
                            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Avg.Temperature&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span>
                            <span class="n">xticks_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.13</span><span class="p">,</span> <span class="n">xticks_rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">xlabel_size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">ylabel_size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                            <span class="n">title_height</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">shadow_alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">shadow_color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">legend_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.065</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bb53bdde7153601622530497462b6a42de812112e5c4fbb3447f3e05a1147576.png" src="_images/bb53bdde7153601622530497462b6a42de812112e5c4fbb3447f3e05a1147576.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;&#39;</span>
<span class="sd"># Only plotting future forecast </span>

<span class="sd">predicted_values = Y_future_hat</span>
<span class="sd">prediction_dates = forecasting_dates</span>
<span class="sd">test_window = None</span>

<span class="sd">predictive_time_series_plot(n_cols=3, figsize=(15,15), </span>
<span class="sd">                            data=temp_day_df.filter(pl.col(&#39;year&#39;)==2016, pl.col(&#39;month&#39;).is_in([10, 11, 12])), </span>
<span class="sd">                            x_name=&#39;date&#39;, y_name=&#39;T&#39;, true_color=&#39;blue&#39;, pred_color=&#39;red&#39;,</span>
<span class="sd">                            predicted_values=predicted_values, prediction_dates=prediction_dates, test_window=test_window, scores=score, score_name=&#39;MAE&#39;,</span>
<span class="sd">                            title=f&quot;Forecasting Daily Avg.Temperature - Forecast window of {forecast_window} days&quot;, </span>
<span class="sd">                            title_size=13, title_weight=&#39;bold&#39;, subtitles_size=9,</span>
<span class="sd">                            marker=&#39;&#39;, markersize=5, ylabel=&#39;Avg.Temperature&#39;, xlabel=&#39;Date&#39;,</span>
<span class="sd">                            xticks_size=9, hspace=0.7, wspace=0.13, xticks_rotation=20, xlabel_size=11, ylabel_size=11,</span>
<span class="sd">                            title_height=0.93, shadow_alpha=0.15, shadow_color=&#39;green&#39;, legend_size=10)</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\&#39;\n# Only plotting future forecast \n\npredicted_values = Y_future_hat\nprediction_dates = forecasting_dates\ntest_window = None\n\npredictive_time_series_plot(n_cols=3, figsize=(15,15), \n                            data=temp_day_df.filter(pl.col(\&#39;year\&#39;)==2016, pl.col(\&#39;month\&#39;).is_in([10, 11, 12])), \n                            x_name=\&#39;date\&#39;, y_name=\&#39;T\&#39;, true_color=\&#39;blue\&#39;, pred_color=\&#39;red\&#39;,\n                            predicted_values=predicted_values, prediction_dates=prediction_dates, test_window=test_window, scores=score, score_name=\&#39;MAE\&#39;,\n                            title=f&quot;Forecasting Daily Avg.Temperature - Forecast window of {forecast_window} days&quot;, \n                            title_size=13, title_weight=\&#39;bold\&#39;, subtitles_size=9,\n                            marker=\&#39;\&#39;, markersize=5, ylabel=\&#39;Avg.Temperature\&#39;, xlabel=\&#39;Date\&#39;,\n                            xticks_size=9, hspace=0.7, wspace=0.13, xticks_rotation=20, xlabel_size=11, ylabel_size=11,\n                            title_height=0.93, shadow_alpha=0.15, shadow_color=\&#39;green\&#39;, legend_size=10)\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd"># Only plotting test forecast</span>

<span class="sd">predicted_values = Y_test_hat</span>
<span class="sd">prediction_dates = test_dates </span>
<span class="sd">shadow_alpha = 0</span>

<span class="sd">predictive_time_series_plot(n_cols=3, figsize=(15,15), </span>
<span class="sd">                            data=temp_day_df.filter(pl.col(&#39;year&#39;)==2016, pl.col(&#39;month&#39;).is_in([10, 11, 12])), </span>
<span class="sd">                            x_name=&#39;date&#39;, y_name=&#39;T&#39;, true_color=&#39;blue&#39;, pred_color=&#39;red&#39;,</span>
<span class="sd">                            predicted_values=predicted_values, prediction_dates=prediction_dates, test_window=test_window, scores=score, score_name=&#39;MAE&#39;,</span>
<span class="sd">                            title=f&quot;Forecasting Daily Avg.Temperature - Forecast window of {forecast_window} days&quot;, </span>
<span class="sd">                            title_size=13, title_weight=&#39;bold&#39;, subtitles_size=9,</span>
<span class="sd">                            marker=&#39;&#39;, markersize=5, ylabel=&#39;Avg.Temperature&#39;, xlabel=&#39;Date&#39;,</span>
<span class="sd">                            xticks_size=9, hspace=0.7, wspace=0.13, xticks_rotation=20, xlabel_size=11, ylabel_size=11,</span>
<span class="sd">                            title_height=0.93, shadow_alpha=shadow_alpha, shadow_color=&#39;green&#39;, legend_size=10)</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\n# Only plotting test forecast\n\npredicted_values = Y_test_hat\nprediction_dates = test_dates \nshadow_alpha = 0\n\npredictive_time_series_plot(n_cols=3, figsize=(15,15), \n                            data=temp_day_df.filter(pl.col(\&#39;year\&#39;)==2016, pl.col(\&#39;month\&#39;).is_in([10, 11, 12])), \n                            x_name=\&#39;date\&#39;, y_name=\&#39;T\&#39;, true_color=\&#39;blue\&#39;, pred_color=\&#39;red\&#39;,\n                            predicted_values=predicted_values, prediction_dates=prediction_dates, test_window=test_window, scores=score, score_name=\&#39;MAE\&#39;,\n                            title=f&quot;Forecasting Daily Avg.Temperature - Forecast window of {forecast_window} days&quot;, \n                            title_size=13, title_weight=\&#39;bold\&#39;, subtitles_size=9,\n                            marker=\&#39;\&#39;, markersize=5, ylabel=\&#39;Avg.Temperature\&#39;, xlabel=\&#39;Date\&#39;,\n                            xticks_size=9, hspace=0.7, wspace=0.13, xticks_rotation=20, xlabel_size=11, ylabel_size=11,\n                            title_height=0.93, shadow_alpha=shadow_alpha, shadow_color=\&#39;green\&#39;, legend_size=10)\n&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="selecting-the-best-model">
<h5><strong>Selecting the best model</strong><a class="headerlink" href="#selecting-the-best-model" title="Link to this heading">#</a></h5>
<p>Given the previous results, in this section we get the best model, that is, the one with the least inner error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">inner_scores_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">best_model_SV</span> <span class="o">=</span> <span class="n">model_names</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">inner_scores_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">model_names</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">),</span> 
                     <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_model_SV</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Model Selection - Daily Temperature (C) </span><span class="se">\n\n</span><span class="s1"> Simple Validation - Test window </span><span class="si">{</span><span class="n">test_window</span><span class="si">}</span><span class="s1"> days &#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The best model according to simple validation is&#39;</span><span class="p">,</span> <span class="n">best_model_SV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f8eded9f004badb0f7ade8c24bd866d69f462d55f1789a75f0a91a81a66696f1.png" src="_images/f8eded9f004badb0f7ade8c24bd866d69f462d55f1789a75f0a91a81a66696f1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The best model according to simple validation is knn (lag=30)
</pre></div>
</div>
</div>
</div>
<p>According to simple validation with a test window fo 15 days, the best model for forecasting the temperature in Jena is the KNN algorithm with 30 lags.</p>
<p>As we can see the lags have a crucial influence in the forecasting results.</p>
</section>
</section>
<section id="cross-validation">
<h4><strong>Cross Validation</strong><a class="headerlink" href="#cross-validation" title="Link to this heading">#</a></h4>
<p>We perform the same as before but using K-Fold cross validation, with <span class="math notranslate nohighlight">\(K=10\)</span>.</p>
<p>This is a much more accurate approach to estimate the (inner) error of a model, and this is specially true in time series where the forecast error could be very dependent on the train-validate   partitions.
This method makes the estimation less dependent on that, since the model is trained and  evaluated in  different partitions, making the estimation more robust and  precise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_splits</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">series</span> <span class="o">=</span> <span class="s1">&#39;T&#39;</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Computing inner score by K-Fold CV for <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> implementation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">st_models</span><span class="p">[</span><span class="n">series</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">st_models</span><span class="p">[</span><span class="n">series</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">scores</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">KFold_score_time_series</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> 
                                          <span class="n">X</span><span class="o">=</span><span class="n">X_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> 
                                          <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> 
                                          <span class="n">scoring</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">)</span>                                    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SARIMA(D=1, P=1, p=2, s=7)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(D=1, P=2, p=2, s=7)
Fold&#39;s size: 290. Train size: 275. Test size: 15
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SARIMA(D=2, P=2, p=2, s=7)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(D=2, P=1, p=2, s=7)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(D=1, P=1, p=2, s=14)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(D=1, P=1, p=2, s=30)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SimpleExpSmooth(smoothing_level=0.05)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SimpleExpSmooth(smoothing_level=0.5)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SimpleExpSmooth(smoothing_level=0.8)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SimpleExpSmooth(smoothing_level=1.5)
Fold&#39;s size: 290. Train size: 275. Test size: 15
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Computing inner score by K-Fold CV for <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> implementation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lags_grid</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sk_models</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">sk_models</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">scores</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KFold_score_time_series</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> 
                                            <span class="n">X</span><span class="o">=</span><span class="n">X_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> 
                                            <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> 
                                            <span class="n">scoring</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">)</span>                                    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
Linear Regression
Fold&#39;s size: 290. Train size: 275. Test size: 15
knn
Fold&#39;s size: 290. Train size: 275. Test size: 15
2
Linear Regression
Fold&#39;s size: 290. Train size: 275. Test size: 15
knn
Fold&#39;s size: 290. Train size: 275. Test size: 15
3
Linear Regression
Fold&#39;s size: 290. Train size: 275. Test size: 15
knn
Fold&#39;s size: 290. Train size: 275. Test size: 15
7
Linear Regression
Fold&#39;s size: 289. Train size: 274. Test size: 15
knn
Fold&#39;s size: 289. Train size: 274. Test size: 15
10
Linear Regression
Fold&#39;s size: 289. Train size: 274. Test size: 15
knn
Fold&#39;s size: 289. Train size: 274. Test size: 15
20
Linear Regression
Fold&#39;s size: 288. Train size: 273. Test size: 15
knn
Fold&#39;s size: 288. Train size: 273. Test size: 15
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30
Linear Regression
Fold&#39;s size: 287. Train size: 272. Test size: 15
knn
Fold&#39;s size: 287. Train size: 272. Test size: 15
40
Linear Regression
Fold&#39;s size: 286. Train size: 271. Test size: 15
knn
Fold&#39;s size: 286. Train size: 271. Test size: 15
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Computing inner score by K-Fold CV for <code class="docutils literal notranslate"><span class="pre">pdmarima</span></code> implementation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Auto SARIMA&#39;</span>

<span class="n">auto_sarima</span> <span class="o">=</span> <span class="n">autoSARIMA</span><span class="p">(</span><span class="n">seasonal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                         <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">scores</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">KFold_score_time_series</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">auto_sarima</span><span class="p">,</span> 
                                          <span class="n">X</span><span class="o">=</span><span class="n">X_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> 
                                          <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> 
                                          <span class="n">scoring</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">)</span>                                    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fold&#39;s size: 290. Train size: 275. Test size: 15
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=1482.445, Time=0.16 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=1525.761, Time=0.01 sec
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1294.899, Time=0.14 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1305.493, Time=0.14 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=1527.658, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=1339.845, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1273.720, Time=0.29 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=1235.321, Time=0.62 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=1234.282, Time=0.25 sec
 ARIMA(1,0,0)(0,1,1)[7] intercept   : AIC=1233.493, Time=0.16 sec
 ARIMA(1,0,0)(0,1,2)[7] intercept   : AIC=1234.110, Time=0.27 sec
 ARIMA(1,0,0)(1,1,2)[7] intercept   : AIC=inf, Time=0.64 sec
 ARIMA(0,0,0)(0,1,1)[7] intercept   : AIC=1481.386, Time=0.08 sec
 ARIMA(2,0,0)(0,1,1)[7] intercept   : AIC=1232.437, Time=0.22 sec
 ARIMA(2,0,0)(0,1,0)[7] intercept   : AIC=1327.651, Time=0.05 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=1232.780, Time=0.32 sec
 ARIMA(2,0,0)(0,1,2)[7] intercept   : AIC=1232.608, Time=0.39 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=1284.345, Time=0.17 sec
 ARIMA(2,0,0)(1,1,2)[7] intercept   : AIC=inf, Time=0.72 sec
 ARIMA(3,0,0)(0,1,1)[7] intercept   : AIC=1221.996, Time=0.25 sec
 ARIMA(3,0,0)(0,1,0)[7] intercept   : AIC=1325.443, Time=0.08 sec
 ARIMA(3,0,0)(1,1,1)[7] intercept   : AIC=1222.574, Time=0.54 sec
 ARIMA(3,0,0)(0,1,2)[7] intercept   : AIC=1222.457, Time=0.50 sec
 ARIMA(3,0,0)(1,1,0)[7] intercept   : AIC=1279.174, Time=0.19 sec
 ARIMA(3,0,0)(1,1,2)[7] intercept   : AIC=inf, Time=0.74 sec
 ARIMA(3,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.87 sec
 ARIMA(2,0,1)(0,1,1)[7] intercept   : AIC=1228.654, Time=0.25 sec
 ARIMA(3,0,0)(0,1,1)[7]             : AIC=1226.271, Time=0.17 sec

Best model:  ARIMA(3,0,0)(0,1,1)[7] intercept
Total fit time: 8.215 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=1644.332, Time=0.12 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=1711.413, Time=0.02 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1362.251, Time=0.09 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1441.573, Time=0.15 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=1710.958, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=1442.680, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1325.655, Time=0.27 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.13 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.67 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=1633.670, Time=0.31 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=1318.056, Time=0.25 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=1352.539, Time=0.10 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.65 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.80 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=1318.406, Time=0.51 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=1319.040, Time=0.53 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=1317.040, Time=0.40 sec
 ARIMA(1,0,1)(1,1,0)[7] intercept   : AIC=1351.879, Time=0.15 sec
 ARIMA(1,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=1.32 sec
 ARIMA(1,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.74 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=1436.274, Time=0.30 sec
 ARIMA(1,0,2)(2,1,0)[7] intercept   : AIC=1319.039, Time=0.45 sec
 ARIMA(0,0,2)(2,1,0)[7] intercept   : AIC=1365.407, Time=0.38 sec
 ARIMA(2,0,2)(2,1,0)[7] intercept   : AIC=1320.959, Time=0.89 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=1316.369, Time=0.16 sec
 ARIMA(1,0,1)(1,1,0)[7]             : AIC=1350.624, Time=0.07 sec
 ARIMA(1,0,1)(2,1,1)[7]             : AIC=inf, Time=0.59 sec
 ARIMA(1,0,1)(1,1,1)[7]             : AIC=inf, Time=0.22 sec
 ARIMA(0,0,1)(2,1,0)[7]             : AIC=1440.136, Time=0.17 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=1324.704, Time=0.13 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=1318.363, Time=0.27 sec
 ARIMA(1,0,2)(2,1,0)[7]             : AIC=1318.358, Time=0.21 sec
 ARIMA(0,0,0)(2,1,0)[7]             : AIC=1639.408, Time=0.08 sec
 ARIMA(0,0,2)(2,1,0)[7]             : AIC=1367.708, Time=0.14 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=1317.465, Time=0.17 sec
 ARIMA(2,0,2)(2,1,0)[7]             : AIC=1320.311, Time=0.36 sec

Best model:  ARIMA(1,0,1)(2,1,0)[7]          
Total fit time: 13.802 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=1649.139, Time=0.08 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=1693.728, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1390.372, Time=0.09 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1433.464, Time=0.24 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=1692.046, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=1456.508, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1340.008, Time=0.25 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.52 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.66 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=1644.116, Time=0.43 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=1326.600, Time=0.41 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=1371.540, Time=0.13 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.71 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.79 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=1323.976, Time=0.39 sec
 ARIMA(3,0,0)(1,1,0)[7] intercept   : AIC=1370.455, Time=0.20 sec
 ARIMA(3,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.60 sec
 ARIMA(3,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=1.32 sec
 ARIMA(3,0,1)(2,1,0)[7] intercept   : AIC=1323.217, Time=0.97 sec
 ARIMA(3,0,1)(1,1,0)[7] intercept   : AIC=1371.685, Time=0.42 sec
 ARIMA(3,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=1.83 sec
 ARIMA(3,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=1.09 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=1321.266, Time=0.53 sec
 ARIMA(2,0,1)(1,1,0)[7] intercept   : AIC=1369.884, Time=0.26 sec
 ARIMA(2,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=1.11 sec
 ARIMA(2,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=1.00 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=1321.651, Time=0.31 sec
 ARIMA(2,0,2)(2,1,0)[7] intercept   : AIC=1323.220, Time=0.86 sec
 ARIMA(1,0,2)(2,1,0)[7] intercept   : AIC=1321.686, Time=0.52 sec
 ARIMA(3,0,2)(2,1,0)[7] intercept   : AIC=1325.217, Time=1.08 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=1319.312, Time=0.21 sec
 ARIMA(2,0,1)(1,1,0)[7]             : AIC=1367.929, Time=0.16 sec
 ARIMA(2,0,1)(2,1,1)[7]             : AIC=inf, Time=1.00 sec
 ARIMA(2,0,1)(1,1,1)[7]             : AIC=inf, Time=0.66 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=1319.710, Time=0.14 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=1324.664, Time=0.15 sec
 ARIMA(3,0,1)(2,1,0)[7]             : AIC=1321.265, Time=0.23 sec
 ARIMA(2,0,2)(2,1,0)[7]             : AIC=1321.268, Time=0.32 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=1338.034, Time=0.15 sec
 ARIMA(1,0,2)(2,1,0)[7]             : AIC=1319.728, Time=0.20 sec
 ARIMA(3,0,0)(2,1,0)[7]             : AIC=1322.016, Time=0.20 sec
 ARIMA(3,0,2)(2,1,0)[7]             : AIC=1323.265, Time=0.52 sec

Best model:  ARIMA(2,0,1)(2,1,0)[7]          
Total fit time: 23.785 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.35 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=1630.187, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1347.710, Time=0.13 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1422.393, Time=0.12 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=1629.171, Time=0.02 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=1391.541, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1320.977, Time=0.30 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.12 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.70 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=1580.670, Time=0.42 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=1319.995, Time=0.33 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=1345.912, Time=0.16 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.33 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.57 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=1321.708, Time=0.40 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=1321.917, Time=0.55 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=1319.941, Time=0.37 sec
 ARIMA(1,0,1)(1,1,0)[7] intercept   : AIC=1346.067, Time=0.13 sec
 ARIMA(1,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=1.83 sec
 ARIMA(1,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.68 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=1430.854, Time=0.33 sec
 ARIMA(1,0,2)(2,1,0)[7] intercept   : AIC=1321.807, Time=0.45 sec
 ARIMA(0,0,2)(2,1,0)[7] intercept   : AIC=1361.337, Time=0.35 sec
 ARIMA(2,0,2)(2,1,0)[7] intercept   : AIC=1321.506, Time=0.85 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=1318.452, Time=0.14 sec
 ARIMA(1,0,1)(1,1,0)[7]             : AIC=1344.214, Time=0.08 sec
 ARIMA(1,0,1)(2,1,1)[7]             : AIC=1287.892, Time=0.45 sec
 ARIMA(1,0,1)(1,1,1)[7]             : AIC=1286.013, Time=0.22 sec
 ARIMA(1,0,1)(0,1,1)[7]             : AIC=1286.840, Time=0.16 sec
 ARIMA(1,0,1)(1,1,2)[7]             : AIC=1287.793, Time=0.58 sec
 ARIMA(1,0,1)(0,1,0)[7]             : AIC=1388.126, Time=0.02 sec
 ARIMA(1,0,1)(0,1,2)[7]             : AIC=1285.900, Time=0.37 sec
 ARIMA(0,0,1)(0,1,2)[7]             : AIC=1428.478, Time=0.20 sec
 ARIMA(1,0,0)(0,1,2)[7]             : AIC=inf, Time=0.25 sec
 ARIMA(2,0,1)(0,1,2)[7]             : AIC=1287.680, Time=0.47 sec
 ARIMA(1,0,2)(0,1,2)[7]             : AIC=inf, Time=0.63 sec
 ARIMA(0,0,0)(0,1,2)[7]             : AIC=1589.629, Time=0.13 sec
 ARIMA(0,0,2)(0,1,2)[7]             : AIC=1355.117, Time=0.26 sec
 ARIMA(2,0,0)(0,1,2)[7]             : AIC=1286.070, Time=0.35 sec
 ARIMA(2,0,2)(0,1,2)[7]             : AIC=1289.559, Time=1.15 sec
 ARIMA(1,0,1)(0,1,2)[7] intercept   : AIC=inf, Time=1.08 sec

Best model:  ARIMA(1,0,1)(0,1,2)[7]          
Total fit time: 18.047 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=1594.721, Time=0.11 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=1659.649, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1358.406, Time=0.15 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1389.265, Time=0.15 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=1658.276, Time=0.02 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=1401.854, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1318.779, Time=0.20 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=0.74 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.55 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=1579.998, Time=0.45 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=1289.217, Time=0.31 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=1321.541, Time=0.13 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=1268.233, Time=0.56 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.62 sec
 ARIMA(2,0,0)(2,1,2)[7] intercept   : AIC=1269.920, Time=0.82 sec
 ARIMA(2,0,0)(1,1,2)[7] intercept   : AIC=inf, Time=0.91 sec
 ARIMA(3,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.12 sec
 ARIMA(2,0,1)(2,1,1)[7] intercept   : AIC=1267.697, Time=0.70 sec
 ARIMA(2,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.78 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=1290.732, Time=0.50 sec
 ARIMA(2,0,1)(2,1,2)[7] intercept   : AIC=inf, Time=1.75 sec
 ARIMA(2,0,1)(1,1,0)[7] intercept   : AIC=1323.337, Time=0.20 sec
 ARIMA(2,0,1)(1,1,2)[7] intercept   : AIC=inf, Time=1.33 sec
 ARIMA(1,0,1)(2,1,1)[7] intercept   : AIC=1265.809, Time=0.49 sec
 ARIMA(1,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.59 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=1290.833, Time=0.28 sec
 ARIMA(1,0,1)(2,1,2)[7] intercept   : AIC=inf, Time=1.76 sec
 ARIMA(1,0,1)(1,1,0)[7] intercept   : AIC=1325.111, Time=0.13 sec
 ARIMA(1,0,1)(1,1,2)[7] intercept   : AIC=inf, Time=1.09 sec
 ARIMA(0,0,1)(2,1,1)[7] intercept   : AIC=1382.698, Time=0.40 sec
 ARIMA(1,0,2)(2,1,1)[7] intercept   : AIC=1267.643, Time=0.63 sec
 ARIMA(0,0,0)(2,1,1)[7] intercept   : AIC=1581.648, Time=0.31 sec
 ARIMA(0,0,2)(2,1,1)[7] intercept   : AIC=1307.573, Time=0.51 sec
 ARIMA(2,0,2)(2,1,1)[7] intercept   : AIC=inf, Time=1.90 sec
 ARIMA(1,0,1)(2,1,1)[7]             : AIC=1264.293, Time=0.37 sec
 ARIMA(1,0,1)(1,1,1)[7]             : AIC=inf, Time=0.28 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=1289.176, Time=0.12 sec
 ARIMA(1,0,1)(2,1,2)[7]             : AIC=1266.283, Time=1.10 sec
 ARIMA(1,0,1)(1,1,0)[7]             : AIC=1323.293, Time=0.06 sec
 ARIMA(1,0,1)(1,1,2)[7]             : AIC=inf, Time=0.59 sec
 ARIMA(0,0,1)(2,1,1)[7]             : AIC=1382.413, Time=0.18 sec
 ARIMA(1,0,0)(2,1,1)[7]             : AIC=inf, Time=0.52 sec
 ARIMA(2,0,1)(2,1,1)[7]             : AIC=1266.192, Time=0.51 sec
 ARIMA(1,0,2)(2,1,1)[7]             : AIC=1266.141, Time=0.50 sec
 ARIMA(0,0,0)(2,1,1)[7]             : AIC=1581.806, Time=0.14 sec
 ARIMA(0,0,2)(2,1,1)[7]             : AIC=1306.831, Time=0.26 sec
 ARIMA(2,0,0)(2,1,1)[7]             : AIC=1266.758, Time=0.42 sec
 ARIMA(2,0,2)(2,1,1)[7]             : AIC=inf, Time=1.59 sec

Best model:  ARIMA(1,0,1)(2,1,1)[7]          
Total fit time: 26.874 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=1621.519, Time=0.13 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=1660.443, Time=0.02 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1272.520, Time=0.12 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1398.595, Time=0.14 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=1658.814, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=1350.803, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1238.851, Time=0.29 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=1208.123, Time=0.65 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=1206.385, Time=0.18 sec
 ARIMA(1,0,0)(0,1,1)[7] intercept   : AIC=1204.813, Time=0.14 sec
 ARIMA(1,0,0)(0,1,2)[7] intercept   : AIC=1206.420, Time=0.32 sec
 ARIMA(1,0,0)(1,1,2)[7] intercept   : AIC=1208.339, Time=0.65 sec
 ARIMA(0,0,0)(0,1,1)[7] intercept   : AIC=1622.832, Time=0.07 sec
 ARIMA(2,0,0)(0,1,1)[7] intercept   : AIC=1200.593, Time=0.22 sec
 ARIMA(2,0,0)(0,1,0)[7] intercept   : AIC=1331.909, Time=0.03 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=1202.554, Time=0.33 sec
 ARIMA(2,0,0)(0,1,2)[7] intercept   : AIC=1202.559, Time=0.59 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=1259.996, Time=0.16 sec
 ARIMA(2,0,0)(1,1,2)[7] intercept   : AIC=1204.473, Time=1.33 sec
 ARIMA(3,0,0)(0,1,1)[7] intercept   : AIC=1201.527, Time=0.26 sec
 ARIMA(2,0,1)(0,1,1)[7] intercept   : AIC=1201.109, Time=0.41 sec
 ARIMA(1,0,1)(0,1,1)[7] intercept   : AIC=1199.796, Time=0.25 sec
 ARIMA(1,0,1)(0,1,0)[7] intercept   : AIC=1334.553, Time=0.04 sec
 ARIMA(1,0,1)(1,1,1)[7] intercept   : AIC=1201.756, Time=0.32 sec
 ARIMA(1,0,1)(0,1,2)[7] intercept   : AIC=1201.762, Time=0.48 sec
 ARIMA(1,0,1)(1,1,0)[7] intercept   : AIC=1259.869, Time=0.15 sec
 ARIMA(1,0,1)(1,1,2)[7] intercept   : AIC=1203.666, Time=0.92 sec
 ARIMA(1,0,2)(0,1,1)[7] intercept   : AIC=1201.266, Time=0.36 sec
 ARIMA(0,0,2)(0,1,1)[7] intercept   : AIC=1315.670, Time=0.19 sec
 ARIMA(2,0,2)(0,1,1)[7] intercept   : AIC=inf, Time=0.88 sec
 ARIMA(1,0,1)(0,1,1)[7]             : AIC=1201.155, Time=0.15 sec

Best model:  ARIMA(1,0,1)(0,1,1)[7] intercept
Total fit time: 9.832 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=1562.805, Time=0.18 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=1641.069, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1320.581, Time=0.10 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1370.869, Time=0.18 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=1639.576, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=1412.133, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1293.105, Time=0.30 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.12 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.60 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=1567.538, Time=0.43 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=1283.087, Time=0.27 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=1310.835, Time=0.15 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.59 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.62 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=1282.986, Time=0.43 sec
 ARIMA(3,0,0)(1,1,0)[7] intercept   : AIC=1311.989, Time=0.17 sec
 ARIMA(3,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.70 sec
 ARIMA(3,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=1.02 sec
 ARIMA(3,0,1)(2,1,0)[7] intercept   : AIC=1284.521, Time=1.24 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=1283.383, Time=0.56 sec
 ARIMA(3,0,0)(2,1,0)[7]             : AIC=1281.327, Time=0.19 sec
 ARIMA(3,0,0)(1,1,0)[7]             : AIC=1310.234, Time=0.08 sec
 ARIMA(3,0,0)(2,1,1)[7]             : AIC=inf, Time=0.55 sec
 ARIMA(3,0,0)(1,1,1)[7]             : AIC=inf, Time=0.37 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=1281.464, Time=0.23 sec
 ARIMA(3,0,1)(2,1,0)[7]             : AIC=1282.844, Time=0.38 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=1281.739, Time=0.17 sec

Best model:  ARIMA(3,0,0)(2,1,0)[7]          
Total fit time: 12.667 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=1476.830, Time=0.12 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=1536.876, Time=0.02 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1285.233, Time=0.11 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1324.708, Time=0.10 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=1535.821, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=1359.050, Time=0.03 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1251.765, Time=0.26 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=1213.163, Time=0.51 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=1212.192, Time=0.22 sec
 ARIMA(1,0,0)(0,1,1)[7] intercept   : AIC=1211.917, Time=0.17 sec
 ARIMA(1,0,0)(0,1,2)[7] intercept   : AIC=1211.928, Time=0.37 sec
 ARIMA(1,0,0)(1,1,2)[7] intercept   : AIC=1213.466, Time=0.63 sec
 ARIMA(0,0,0)(0,1,1)[7] intercept   : AIC=1475.288, Time=0.06 sec
 ARIMA(2,0,0)(0,1,1)[7] intercept   : AIC=1213.615, Time=0.15 sec
 ARIMA(1,0,1)(0,1,1)[7] intercept   : AIC=1213.542, Time=0.19 sec
 ARIMA(2,0,1)(0,1,1)[7] intercept   : AIC=1234.236, Time=0.75 sec
 ARIMA(1,0,0)(0,1,1)[7]             : AIC=1213.703, Time=0.08 sec

Best model:  ARIMA(1,0,0)(0,1,1)[7] intercept
Total fit time: 3.766 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=1630.439, Time=0.13 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=1722.277, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1380.524, Time=0.10 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.31 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=1720.611, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=1440.191, Time=0.03 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1330.035, Time=0.31 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.00 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.47 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=1625.204, Time=0.52 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=1328.332, Time=0.24 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=1375.110, Time=0.10 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.48 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.78 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=1328.447, Time=0.33 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=1325.235, Time=0.87 sec
 ARIMA(2,0,1)(1,1,0)[7] intercept   : AIC=1374.079, Time=0.35 sec
 ARIMA(2,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=1.57 sec
 ARIMA(2,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.53 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=1327.136, Time=0.34 sec
 ARIMA(3,0,1)(2,1,0)[7] intercept   : AIC=1327.019, Time=0.63 sec
 ARIMA(2,0,2)(2,1,0)[7] intercept   : AIC=1327.079, Time=0.76 sec
 ARIMA(1,0,2)(2,1,0)[7] intercept   : AIC=1326.706, Time=0.42 sec
 ARIMA(3,0,2)(2,1,0)[7] intercept   : AIC=1320.071, Time=1.84 sec
 ARIMA(3,0,2)(1,1,0)[7] intercept   : AIC=inf, Time=1.20 sec
 ARIMA(3,0,2)(2,1,1)[7] intercept   : AIC=inf, Time=1.99 sec
 ARIMA(3,0,2)(1,1,1)[7] intercept   : AIC=inf, Time=1.19 sec
 ARIMA(3,0,3)(2,1,0)[7] intercept   : AIC=inf, Time=2.15 sec
 ARIMA(2,0,3)(2,1,0)[7] intercept   : AIC=1322.710, Time=0.74 sec
 ARIMA(3,0,2)(2,1,0)[7]             : AIC=inf, Time=1.10 sec

Best model:  ARIMA(3,0,2)(2,1,0)[7] intercept
Total fit time: 21.522 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=1552.473, Time=0.13 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=1605.460, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1262.900, Time=0.14 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1339.163, Time=0.17 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=1603.481, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=1328.792, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1238.664, Time=0.27 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.23 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.77 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=1551.282, Time=0.26 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=1209.429, Time=0.32 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=1230.647, Time=0.15 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.28 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.86 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=1208.465, Time=0.35 sec
 ARIMA(3,0,0)(1,1,0)[7] intercept   : AIC=1231.730, Time=0.20 sec
 ARIMA(3,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=2.05 sec
 ARIMA(3,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.94 sec
 ARIMA(3,0,1)(2,1,0)[7] intercept   : AIC=1210.012, Time=0.59 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=1208.012, Time=0.44 sec
 ARIMA(2,0,1)(1,1,0)[7] intercept   : AIC=1231.683, Time=0.21 sec
 ARIMA(2,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=1.52 sec
 ARIMA(2,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.89 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=1206.397, Time=0.37 sec
 ARIMA(1,0,1)(1,1,0)[7] intercept   : AIC=1232.149, Time=0.18 sec
 ARIMA(1,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=1.59 sec
 ARIMA(1,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.89 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=1334.662, Time=0.33 sec
 ARIMA(1,0,2)(2,1,0)[7] intercept   : AIC=1208.012, Time=0.35 sec
 ARIMA(0,0,2)(2,1,0)[7] intercept   : AIC=1248.956, Time=0.38 sec
 ARIMA(2,0,2)(2,1,0)[7] intercept   : AIC=1208.983, Time=0.95 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=1204.415, Time=0.10 sec
 ARIMA(1,0,1)(1,1,0)[7]             : AIC=1230.152, Time=0.05 sec
 ARIMA(1,0,1)(2,1,1)[7]             : AIC=inf, Time=1.06 sec
 ARIMA(1,0,1)(1,1,1)[7]             : AIC=inf, Time=0.51 sec
 ARIMA(0,0,1)(2,1,0)[7]             : AIC=1332.689, Time=0.12 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=1236.676, Time=0.12 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=1206.032, Time=0.21 sec
 ARIMA(1,0,2)(2,1,0)[7]             : AIC=1206.031, Time=0.19 sec
 ARIMA(0,0,0)(2,1,0)[7]             : AIC=1549.298, Time=0.07 sec
 ARIMA(0,0,2)(2,1,0)[7]             : AIC=1246.976, Time=0.15 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=1207.455, Time=0.13 sec
 ARIMA(2,0,2)(2,1,0)[7]             : AIC=1207.000, Time=0.44 sec

Best model:  ARIMA(1,0,1)(2,1,0)[7]          
Total fit time: 21.030 seconds
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h5><strong>Selecting the best model</strong><a class="headerlink" href="#id3" title="Link to this heading">#</a></h5>
<p>Given the previous results, in this section we get the best model, that is, the one with the least inner error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">inner_scores_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">best_model_CV</span> <span class="o">=</span> <span class="n">model_names</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">inner_scores_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">model_names</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">),</span> 
                     <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_model_CV</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Model Selection - Daily Temperature (C) </span><span class="se">\n\n</span><span class="s1"> </span><span class="si">{</span><span class="n">n_splits</span><span class="si">}</span><span class="s1"> Fold CV - Test window </span><span class="si">{</span><span class="n">test_window</span><span class="si">}</span><span class="s1"> days&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The best model according to cross validation is&#39;</span><span class="p">,</span> <span class="n">best_model_CV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fd6919681ebfec8bbae6449043d81f9d26349e92fa4f4026d713df833ff4e9fe.png" src="_images/fd6919681ebfec8bbae6449043d81f9d26349e92fa4f4026d713df833ff4e9fe.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The best model according to cross validation is Linear Regression (lag=30)
</pre></div>
</div>
</div>
</div>
<p>According to cross validation with a test window fo 15 days, the best model for forecasting the temperature in Jena is the Linear Regression  algorithm with 30 lags.</p>
<p>We can see again that the lags have a crucial influence in the forecasting results.</p>
</section>
<section id="id4">
<h5><strong>Predictive visualization</strong><a class="headerlink" href="#id4" title="Link to this heading">#</a></h5>
<p>In this section we are going to plot the K-Fold cross validation process applied above for some of the models, just for getting more insight of how it works, and how dependent are the forecast on the train-validate partitions (namely, on the folds).</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\text{SARIMA}(p=1, d=0, q=0)\times(P=1, D=1, Q=0)_{s=7}\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimator</span> <span class="o">=</span> <span class="n">sarima</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sarima</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

<span class="n">KFold_time_series_plot</span><span class="p">(</span><span class="n">n_cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">estimator</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span> 
                       <span class="n">X</span><span class="o">=</span><span class="n">X_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
                       <span class="n">true_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">pred_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Forecasting Daily Avg. Temperature (C) - Forecast window of </span><span class="si">{</span><span class="n">forecast_window</span><span class="si">}</span><span class="s2"> days - </span><span class="si">{</span><span class="n">n_splits</span><span class="si">}</span><span class="s2"> Fold CV - MAE = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                       <span class="n">hspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">subtitles_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">title_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">xticks_rotation</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> 
                       <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.05</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fold&#39;s size: 290. Train size: 275. Test size: 15
</pre></div>
</div>
<img alt="_images/dddb45e4101a1cd40784f50c28211a6c1bddb3bca313ef3c628cff9f0fb56262.png" src="_images/dddb45e4101a1cd40784f50c28211a6c1bddb3bca313ef3c628cff9f0fb56262.png" />
</div>
</div>
<ul class="simple">
<li><p>Linear regression with 30 lags</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimator</span> <span class="o">=</span> <span class="n">linear_regression</span>
<span class="n">lag</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Linear Regression (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span>

<span class="n">KFold_time_series_plot</span><span class="p">(</span><span class="n">n_cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">estimator</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span>  <span class="n">score</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">,</span>
                       <span class="n">X</span><span class="o">=</span><span class="n">X_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
                       <span class="n">true_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">pred_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Forecasting Daily Avg. Temperature (C) - Forecast window of </span><span class="si">{</span><span class="n">forecast_window</span><span class="si">}</span><span class="s2"> days - </span><span class="si">{</span><span class="n">n_splits</span><span class="si">}</span><span class="s2"> Fold CV - MAE = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                       <span class="n">hspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">subtitles_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">title_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">xticks_rotation</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> 
                       <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.05</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fold&#39;s size: 287. Train size: 272. Test size: 15
</pre></div>
</div>
<img alt="_images/e906fcdd5473cc25d52d1829dd6b42a8a7cf6c69fc98ea41ed51fd21e32ad2e8.png" src="_images/e906fcdd5473cc25d52d1829dd6b42a8a7cf6c69fc98ea41ed51fd21e32ad2e8.png" />
</div>
</div>
</section>
<section id="estimation-of-future-performance">
<h5><strong>Estimation of future performance</strong><a class="headerlink" href="#estimation-of-future-performance" title="Link to this heading">#</a></h5>
<p>We estimate the future performance of the best model according to KFold Cross Validation.</p>
<p>This estimates the performance that the best model will have in forecasting the future, but has to be taken carefully since is very dependent on the slot of testing data used, specially in time series.</p>
<p>So the future performance of a model could be very good for some kinds of test date but much worse for other.</p>
<p>For example, if the testing set contains a shock the performance of the model will probably be worse than it was in the validation part, that is, the estimation of future performance will be worse than the cross validation error, just because we are forecasting a really unpredictable  period (a shock).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_model_CV</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Linear Regression (lag=30)&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">linear_regression</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">])</span>
<span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">linear_regression</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">test_window</span><span class="p">)</span>
<span class="n">estimation_future_performance</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">Y_test_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">])</span>
<span class="n">estimation_future_performance</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.0046182746521652
</pre></div>
</div>
</div>
</div>
<p>Now we are going to repeat the previous steps (the ones associated to the cross validation part) for the remaining  two series, humidity and wind speed.</p>
</section>
</section>
</section>
<section id="humidity-rh">
<h3><strong>Humidity (<code class="docutils literal notranslate"><span class="pre">rh</span></code>)</strong><a class="headerlink" href="#humidity-rh" title="Link to this heading">#</a></h3>
<section id="id5">
<h4><strong>Cross Validation</strong><a class="headerlink" href="#id5" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_splits</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">series</span> <span class="o">=</span> <span class="s1">&#39;rh&#39;</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Computing inner score by K-Fold CV for <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> implementation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">st_models</span><span class="p">[</span><span class="n">series</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">st_models</span><span class="p">[</span><span class="n">series</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">scores</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">KFold_score_time_series</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> 
                                          <span class="n">X</span><span class="o">=</span><span class="n">X_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> 
                                          <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> 
                                          <span class="n">scoring</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">)</span>                                    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SARIMA(D=1, P=1, p=1, s=7)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(D=1, P=1, p=2, s=7)
Fold&#39;s size: 290. Train size: 275. Test size: 15
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SARIMA(D=1, P=2, p=1, s=7)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(D=2, P=2, p=1, s=7)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(D=1, P=2, p=2, s=7)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(D=2, P=2, p=2, s=7)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(D=1, P=1, p=1, s=14)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(D=1, P=1, p=2, s=14)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SimpleExpSmooth(smoothing_level=0.05)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SimpleExpSmooth(smoothing_level=0.5)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SimpleExpSmooth(smoothing_level=0.8)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SimpleExpSmooth(smoothing_level=1.5)
Fold&#39;s size: 290. Train size: 275. Test size: 15
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Computing inner score by K-Fold CV for <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> implementation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lags_grid</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sk_models</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">sk_models</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">scores</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KFold_score_time_series</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> 
                                            <span class="n">X</span><span class="o">=</span><span class="n">X_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> 
                                            <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> 
                                            <span class="n">scoring</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">)</span>                                    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
Linear Regression
Fold&#39;s size: 290. Train size: 275. Test size: 15
knn
Fold&#39;s size: 290. Train size: 275. Test size: 15
2
Linear Regression
Fold&#39;s size: 290. Train size: 275. Test size: 15
knn
Fold&#39;s size: 290. Train size: 275. Test size: 15
3
Linear Regression
Fold&#39;s size: 290. Train size: 275. Test size: 15
knn
Fold&#39;s size: 290. Train size: 275. Test size: 15
7
Linear Regression
Fold&#39;s size: 289. Train size: 274. Test size: 15
knn
Fold&#39;s size: 289. Train size: 274. Test size: 15
10
Linear Regression
Fold&#39;s size: 289. Train size: 274. Test size: 15
knn
Fold&#39;s size: 289. Train size: 274. Test size: 15
20
Linear Regression
Fold&#39;s size: 288. Train size: 273. Test size: 15
knn
Fold&#39;s size: 288. Train size: 273. Test size: 15
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30
Linear Regression
Fold&#39;s size: 287. Train size: 272. Test size: 15
knn
Fold&#39;s size: 287. Train size: 272. Test size: 15
40
Linear Regression
Fold&#39;s size: 286. Train size: 271. Test size: 15
knn
Fold&#39;s size: 286. Train size: 271. Test size: 15
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Computing inner score by K-Fold CV for <code class="docutils literal notranslate"><span class="pre">pdmarima</span></code> implementation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Auto SARIMA&#39;</span>

<span class="n">auto_sarima</span> <span class="o">=</span> <span class="n">autoSARIMA</span><span class="p">(</span><span class="n">seasonal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                         <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">scores</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">KFold_score_time_series</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">auto_sarima</span><span class="p">,</span> 
                                          <span class="n">X</span><span class="o">=</span><span class="n">X_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> 
                                          <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> 
                                          <span class="n">scoring</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">)</span>                                    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fold&#39;s size: 290. Train size: 275. Test size: 15
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.45 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=2119.118, Time=0.01 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1998.953, Time=0.16 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.33 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=2117.162, Time=0.02 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=2054.646, Time=0.04 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1972.934, Time=0.34 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.14 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.70 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=2045.514, Time=0.51 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=1953.354, Time=0.39 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=1972.645, Time=0.17 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.03 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.72 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=1951.979, Time=0.59 sec
 ARIMA(3,0,0)(1,1,0)[7] intercept   : AIC=1973.270, Time=0.32 sec
 ARIMA(3,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.45 sec
 ARIMA(3,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.77 sec
 ARIMA(3,0,1)(2,1,0)[7] intercept   : AIC=1950.476, Time=1.00 sec
 ARIMA(3,0,1)(1,1,0)[7] intercept   : AIC=1974.784, Time=0.70 sec
 ARIMA(3,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=1.84 sec
 ARIMA(3,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.96 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=1952.876, Time=0.52 sec
 ARIMA(3,0,2)(2,1,0)[7] intercept   : AIC=1952.177, Time=1.25 sec
 ARIMA(2,0,2)(2,1,0)[7] intercept   : AIC=1954.654, Time=1.26 sec
 ARIMA(3,0,1)(2,1,0)[7]             : AIC=1948.481, Time=0.60 sec
 ARIMA(3,0,1)(1,1,0)[7]             : AIC=1972.802, Time=0.35 sec
 ARIMA(3,0,1)(2,1,1)[7]             : AIC=inf, Time=1.85 sec
 ARIMA(3,0,1)(1,1,1)[7]             : AIC=inf, Time=0.88 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=1950.898, Time=0.20 sec
 ARIMA(3,0,0)(2,1,0)[7]             : AIC=1949.999, Time=0.16 sec
 ARIMA(3,0,2)(2,1,0)[7]             : AIC=1950.193, Time=0.57 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=1951.378, Time=0.15 sec
 ARIMA(2,0,2)(2,1,0)[7]             : AIC=1952.675, Time=0.35 sec

Best model:  ARIMA(3,0,1)(2,1,0)[7]          
Total fit time: 21.817 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.38 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=2105.488, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1969.628, Time=0.15 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.35 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=2104.536, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=2016.840, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1922.823, Time=0.36 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=0.92 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.55 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=2027.524, Time=0.43 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=1924.300, Time=0.56 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=1924.282, Time=0.54 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=1944.496, Time=0.32 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=1926.282, Time=0.68 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=1922.243, Time=0.12 sec
 ARIMA(1,0,0)(1,1,0)[7]             : AIC=1968.358, Time=0.05 sec
 ARIMA(1,0,0)(2,1,1)[7]             : AIC=1894.552, Time=0.36 sec
 ARIMA(1,0,0)(1,1,1)[7]             : AIC=1895.224, Time=0.20 sec
 ARIMA(1,0,0)(2,1,2)[7]             : AIC=1893.290, Time=0.37 sec
 ARIMA(1,0,0)(1,1,2)[7]             : AIC=1892.326, Time=0.35 sec
 ARIMA(1,0,0)(0,1,2)[7]             : AIC=1894.972, Time=0.33 sec
 ARIMA(1,0,0)(0,1,1)[7]             : AIC=1894.050, Time=0.14 sec
 ARIMA(0,0,0)(1,1,2)[7]             : AIC=inf, Time=0.36 sec
 ARIMA(2,0,0)(1,1,2)[7]             : AIC=1894.317, Time=0.57 sec
 ARIMA(1,0,1)(1,1,2)[7]             : AIC=1894.314, Time=0.61 sec
 ARIMA(0,0,1)(1,1,2)[7]             : AIC=1929.368, Time=0.40 sec
 ARIMA(2,0,1)(1,1,2)[7]             : AIC=1895.913, Time=1.40 sec
 ARIMA(1,0,0)(1,1,2)[7] intercept   : AIC=inf, Time=0.93 sec

Best model:  ARIMA(1,0,0)(1,1,2)[7]          
Total fit time: 11.460 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=2013.824, Time=0.14 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=2149.287, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1941.907, Time=0.16 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1916.089, Time=0.13 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=2147.659, Time=0.00 sec
 ARIMA(0,0,1)(0,1,0)[7] intercept   : AIC=2052.097, Time=0.05 sec
 ARIMA(0,0,1)(1,1,1)[7] intercept   : AIC=1913.282, Time=0.20 sec
 ARIMA(0,0,1)(1,1,0)[7] intercept   : AIC=1962.701, Time=0.15 sec
 ARIMA(0,0,1)(2,1,1)[7] intercept   : AIC=1913.607, Time=0.39 sec
 ARIMA(0,0,1)(1,1,2)[7] intercept   : AIC=1910.667, Time=0.70 sec
 ARIMA(0,0,1)(0,1,2)[7] intercept   : AIC=1912.229, Time=0.26 sec
 ARIMA(0,0,1)(2,1,2)[7] intercept   : AIC=1912.659, Time=1.55 sec
 ARIMA(0,0,0)(1,1,2)[7] intercept   : AIC=2010.285, Time=0.60 sec
 ARIMA(1,0,1)(1,1,2)[7] intercept   : AIC=1884.458, Time=1.19 sec
 ARIMA(1,0,1)(0,1,2)[7] intercept   : AIC=1882.698, Time=0.45 sec
 ARIMA(1,0,1)(0,1,1)[7] intercept   : AIC=1884.370, Time=0.26 sec
 ARIMA(1,0,1)(1,1,1)[7] intercept   : AIC=1883.136, Time=0.39 sec
 ARIMA(1,0,0)(0,1,2)[7] intercept   : AIC=1882.634, Time=0.27 sec
 ARIMA(1,0,0)(0,1,1)[7] intercept   : AIC=1884.240, Time=0.15 sec
 ARIMA(1,0,0)(1,1,2)[7] intercept   : AIC=1884.544, Time=0.68 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=1882.979, Time=0.25 sec
 ARIMA(0,0,0)(0,1,2)[7] intercept   : AIC=2012.987, Time=0.23 sec
 ARIMA(2,0,0)(0,1,2)[7] intercept   : AIC=1882.983, Time=0.43 sec
 ARIMA(2,0,1)(0,1,2)[7] intercept   : AIC=1884.586, Time=0.67 sec
 ARIMA(1,0,0)(0,1,2)[7]             : AIC=1882.877, Time=0.25 sec

Best model:  ARIMA(1,0,0)(0,1,2)[7] intercept
Total fit time: 9.523 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=1920.671, Time=0.18 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=2008.499, Time=0.02 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1899.941, Time=0.22 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1862.729, Time=0.18 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=2007.322, Time=0.00 sec
 ARIMA(0,0,1)(0,1,0)[7] intercept   : AIC=1969.020, Time=0.07 sec
 ARIMA(0,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.46 sec
 ARIMA(0,0,1)(0,1,2)[7] intercept   : AIC=inf, Time=0.62 sec
 ARIMA(0,0,1)(1,1,0)[7] intercept   : AIC=1912.076, Time=0.09 sec
 ARIMA(0,0,1)(1,1,2)[7] intercept   : AIC=inf, Time=0.96 sec
 ARIMA(0,0,0)(0,1,1)[7] intercept   : AIC=1921.295, Time=0.05 sec
 ARIMA(1,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.43 sec
 ARIMA(0,0,2)(0,1,1)[7] intercept   : AIC=inf, Time=0.22 sec
 ARIMA(1,0,0)(0,1,1)[7] intercept   : AIC=inf, Time=0.30 sec
 ARIMA(1,0,2)(0,1,1)[7] intercept   : AIC=inf, Time=0.78 sec
 ARIMA(0,0,1)(0,1,1)[7]             : AIC=1868.276, Time=0.09 sec

Best model:  ARIMA(0,0,1)(0,1,1)[7] intercept
Total fit time: 4.672 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.36 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=2128.867, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1988.248, Time=0.15 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1943.306, Time=0.23 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=2126.939, Time=0.02 sec
 ARIMA(0,0,1)(0,1,0)[7] intercept   : AIC=2042.381, Time=0.05 sec
 ARIMA(0,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.43 sec
 ARIMA(0,0,1)(0,1,2)[7] intercept   : AIC=inf, Time=0.83 sec
 ARIMA(0,0,1)(1,1,0)[7] intercept   : AIC=1999.536, Time=0.16 sec
 ARIMA(0,0,1)(1,1,2)[7] intercept   : AIC=inf, Time=1.05 sec
 ARIMA(0,0,0)(0,1,1)[7] intercept   : AIC=2044.086, Time=0.07 sec
 ARIMA(1,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.45 sec
 ARIMA(0,0,2)(0,1,1)[7] intercept   : AIC=1933.229, Time=0.32 sec
 ARIMA(0,0,2)(0,1,0)[7] intercept   : AIC=2034.956, Time=0.10 sec
 ARIMA(0,0,2)(1,1,1)[7] intercept   : AIC=inf, Time=0.66 sec
 ARIMA(0,0,2)(0,1,2)[7] intercept   : AIC=inf, Time=0.76 sec
 ARIMA(0,0,2)(1,1,0)[7] intercept   : AIC=1993.651, Time=0.23 sec
 ARIMA(0,0,2)(1,1,2)[7] intercept   : AIC=inf, Time=1.70 sec
 ARIMA(1,0,2)(0,1,1)[7] intercept   : AIC=inf, Time=0.82 sec
 ARIMA(0,0,3)(0,1,1)[7] intercept   : AIC=inf, Time=0.67 sec
 ARIMA(1,0,3)(0,1,1)[7] intercept   : AIC=inf, Time=0.72 sec
 ARIMA(0,0,2)(0,1,1)[7]             : AIC=1937.187, Time=0.17 sec

Best model:  ARIMA(0,0,2)(0,1,1)[7] intercept
Total fit time: 9.946 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.33 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=2149.771, Time=0.02 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1994.208, Time=0.10 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.35 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=2147.786, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=2058.426, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1956.254, Time=0.32 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=0.83 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.44 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=2059.583, Time=0.53 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=1958.173, Time=0.42 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=1958.178, Time=0.43 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=1980.582, Time=0.39 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=inf, Time=1.49 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=1954.255, Time=0.13 sec
 ARIMA(1,0,0)(1,1,0)[7]             : AIC=1992.209, Time=0.05 sec
 ARIMA(1,0,0)(2,1,1)[7]             : AIC=1913.177, Time=0.37 sec
 ARIMA(1,0,0)(1,1,1)[7]             : AIC=inf, Time=0.18 sec
 ARIMA(1,0,0)(2,1,2)[7]             : AIC=1911.559, Time=0.88 sec
 ARIMA(1,0,0)(1,1,2)[7]             : AIC=inf, Time=0.67 sec
 ARIMA(0,0,0)(2,1,2)[7]             : AIC=2040.824, Time=0.36 sec
 ARIMA(2,0,0)(2,1,2)[7]             : AIC=1913.544, Time=1.09 sec
 ARIMA(1,0,1)(2,1,2)[7]             : AIC=1913.543, Time=1.32 sec
 ARIMA(0,0,1)(2,1,2)[7]             : AIC=1950.004, Time=0.75 sec
 ARIMA(2,0,1)(2,1,2)[7]             : AIC=inf, Time=1.03 sec
 ARIMA(1,0,0)(2,1,2)[7] intercept   : AIC=inf, Time=1.24 sec

Best model:  ARIMA(1,0,0)(2,1,2)[7]          
Total fit time: 13.735 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.39 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=2163.372, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1994.617, Time=0.16 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.33 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=2161.378, Time=0.01 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=2080.776, Time=0.03 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=1974.911, Time=0.40 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.01 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.84 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=2088.179, Time=0.61 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=1976.646, Time=0.42 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=1976.289, Time=0.40 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=1988.368, Time=0.29 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=1972.927, Time=0.85 sec
 ARIMA(2,0,1)(1,1,0)[7] intercept   : AIC=1992.715, Time=0.32 sec
 ARIMA(2,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=1.40 sec
 ARIMA(2,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.79 sec
 ARIMA(3,0,1)(2,1,0)[7] intercept   : AIC=1970.683, Time=1.00 sec
 ARIMA(3,0,1)(1,1,0)[7] intercept   : AIC=1991.054, Time=0.48 sec
 ARIMA(3,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=1.55 sec
 ARIMA(3,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.88 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=1970.810, Time=0.58 sec
 ARIMA(3,0,2)(2,1,0)[7] intercept   : AIC=1972.494, Time=1.25 sec
 ARIMA(2,0,2)(2,1,0)[7] intercept   : AIC=1970.570, Time=0.77 sec
 ARIMA(2,0,2)(1,1,0)[7] intercept   : AIC=1991.521, Time=0.26 sec
 ARIMA(2,0,2)(2,1,1)[7] intercept   : AIC=inf, Time=1.83 sec
 ARIMA(2,0,2)(1,1,1)[7] intercept   : AIC=inf, Time=0.89 sec
 ARIMA(1,0,2)(2,1,0)[7] intercept   : AIC=1970.487, Time=0.53 sec
 ARIMA(1,0,2)(1,1,0)[7] intercept   : AIC=1991.308, Time=0.28 sec
 ARIMA(1,0,2)(2,1,1)[7] intercept   : AIC=inf, Time=1.47 sec
 ARIMA(1,0,2)(1,1,1)[7] intercept   : AIC=inf, Time=0.88 sec
 ARIMA(0,0,2)(2,1,0)[7] intercept   : AIC=1984.433, Time=0.45 sec
 ARIMA(1,0,3)(2,1,0)[7] intercept   : AIC=1970.592, Time=0.70 sec
 ARIMA(0,0,3)(2,1,0)[7] intercept   : AIC=1975.491, Time=0.50 sec
 ARIMA(2,0,3)(2,1,0)[7] intercept   : AIC=1973.266, Time=1.92 sec
 ARIMA(1,0,2)(2,1,0)[7]             : AIC=1968.561, Time=0.24 sec
 ARIMA(1,0,2)(1,1,0)[7]             : AIC=1989.374, Time=0.13 sec
 ARIMA(1,0,2)(2,1,1)[7]             : AIC=inf, Time=1.11 sec
 ARIMA(1,0,2)(1,1,1)[7]             : AIC=inf, Time=0.75 sec
 ARIMA(0,0,2)(2,1,0)[7]             : AIC=1982.615, Time=0.14 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=1974.414, Time=0.15 sec
 ARIMA(2,0,2)(2,1,0)[7]             : AIC=1968.651, Time=0.32 sec
 ARIMA(1,0,3)(2,1,0)[7]             : AIC=1968.676, Time=0.28 sec
 ARIMA(0,0,1)(2,1,0)[7]             : AIC=1986.576, Time=0.12 sec
 ARIMA(0,0,3)(2,1,0)[7]             : AIC=1973.647, Time=0.19 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=1971.050, Time=0.29 sec
 ARIMA(2,0,3)(2,1,0)[7]             : AIC=1970.628, Time=1.05 sec

Best model:  ARIMA(1,0,2)(2,1,0)[7]          
Total fit time: 29.268 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=1977.134, Time=0.14 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=2060.548, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1929.768, Time=0.18 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1893.918, Time=0.13 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=2058.724, Time=0.00 sec
 ARIMA(0,0,1)(0,1,0)[7] intercept   : AIC=2004.933, Time=0.03 sec
 ARIMA(0,0,1)(1,1,1)[7] intercept   : AIC=1895.915, Time=0.19 sec
 ARIMA(0,0,1)(0,1,2)[7] intercept   : AIC=1895.914, Time=0.32 sec
 ARIMA(0,0,1)(1,1,0)[7] intercept   : AIC=1943.975, Time=0.14 sec
 ARIMA(0,0,1)(1,1,2)[7] intercept   : AIC=1897.917, Time=0.40 sec
 ARIMA(0,0,0)(0,1,1)[7] intercept   : AIC=1975.839, Time=0.09 sec
 ARIMA(1,0,1)(0,1,1)[7] intercept   : AIC=1862.088, Time=0.32 sec
 ARIMA(1,0,1)(0,1,0)[7] intercept   : AIC=1997.192, Time=0.05 sec
 ARIMA(1,0,1)(1,1,1)[7] intercept   : AIC=1863.818, Time=0.32 sec
 ARIMA(1,0,1)(0,1,2)[7] intercept   : AIC=1863.792, Time=0.38 sec
 ARIMA(1,0,1)(1,1,0)[7] intercept   : AIC=1931.687, Time=0.22 sec
 ARIMA(1,0,1)(1,1,2)[7] intercept   : AIC=1865.916, Time=0.79 sec
 ARIMA(1,0,0)(0,1,1)[7] intercept   : AIC=1861.200, Time=0.10 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=1995.237, Time=0.03 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=1862.985, Time=0.30 sec
 ARIMA(1,0,0)(0,1,2)[7] intercept   : AIC=1862.968, Time=0.32 sec
 ARIMA(1,0,0)(1,1,2)[7] intercept   : AIC=1865.013, Time=0.66 sec
 ARIMA(2,0,0)(0,1,1)[7] intercept   : AIC=1862.482, Time=0.28 sec
 ARIMA(2,0,1)(0,1,1)[7] intercept   : AIC=1865.176, Time=0.42 sec
 ARIMA(1,0,0)(0,1,1)[7]             : AIC=1862.362, Time=0.12 sec

Best model:  ARIMA(1,0,0)(0,1,1)[7] intercept
Total fit time: 5.914 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.34 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=2086.345, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1950.806, Time=0.12 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1889.841, Time=0.20 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=2084.629, Time=0.00 sec
 ARIMA(0,0,1)(0,1,0)[7] intercept   : AIC=2030.793, Time=0.03 sec
 ARIMA(0,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.56 sec
 ARIMA(0,0,1)(0,1,2)[7] intercept   : AIC=inf, Time=0.87 sec
 ARIMA(0,0,1)(1,1,0)[7] intercept   : AIC=1963.565, Time=0.14 sec
 ARIMA(0,0,1)(1,1,2)[7] intercept   : AIC=inf, Time=1.46 sec
 ARIMA(0,0,0)(0,1,1)[7] intercept   : AIC=1976.562, Time=0.10 sec
 ARIMA(1,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.57 sec
 ARIMA(0,0,2)(0,1,1)[7] intercept   : AIC=inf, Time=0.54 sec
 ARIMA(1,0,0)(0,1,1)[7] intercept   : AIC=inf, Time=0.42 sec
 ARIMA(1,0,2)(0,1,1)[7] intercept   : AIC=inf, Time=0.83 sec
 ARIMA(0,0,1)(0,1,1)[7]             : AIC=1900.083, Time=0.08 sec

Best model:  ARIMA(0,0,1)(0,1,1)[7] intercept
Total fit time: 6.250 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=2038.415, Time=0.17 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=2118.185, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=1963.384, Time=0.15 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=1951.652, Time=0.13 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=2116.231, Time=0.00 sec
 ARIMA(0,0,1)(0,1,0)[7] intercept   : AIC=2056.456, Time=0.03 sec
 ARIMA(0,0,1)(1,1,1)[7] intercept   : AIC=1953.624, Time=0.22 sec
 ARIMA(0,0,1)(0,1,2)[7] intercept   : AIC=1953.634, Time=0.30 sec
 ARIMA(0,0,1)(1,1,0)[7] intercept   : AIC=1979.875, Time=0.15 sec
 ARIMA(0,0,1)(1,1,2)[7] intercept   : AIC=1955.233, Time=0.50 sec
 ARIMA(0,0,0)(0,1,1)[7] intercept   : AIC=2036.766, Time=0.09 sec
 ARIMA(1,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.44 sec
 ARIMA(0,0,2)(0,1,1)[7] intercept   : AIC=1925.834, Time=0.21 sec
 ARIMA(0,0,2)(0,1,0)[7] intercept   : AIC=2038.309, Time=0.10 sec
 ARIMA(0,0,2)(1,1,1)[7] intercept   : AIC=inf, Time=0.63 sec
 ARIMA(0,0,2)(0,1,2)[7] intercept   : AIC=1927.111, Time=0.67 sec
 ARIMA(0,0,2)(1,1,0)[7] intercept   : AIC=1968.398, Time=0.15 sec
 ARIMA(0,0,2)(1,1,2)[7] intercept   : AIC=inf, Time=1.60 sec
 ARIMA(1,0,2)(0,1,1)[7] intercept   : AIC=inf, Time=0.87 sec
 ARIMA(0,0,3)(0,1,1)[7] intercept   : AIC=1922.457, Time=0.40 sec
 ARIMA(0,0,3)(0,1,0)[7] intercept   : AIC=2039.618, Time=0.14 sec
 ARIMA(0,0,3)(1,1,1)[7] intercept   : AIC=inf, Time=0.87 sec
 ARIMA(0,0,3)(0,1,2)[7] intercept   : AIC=inf, Time=1.13 sec
 ARIMA(0,0,3)(1,1,0)[7] intercept   : AIC=1969.310, Time=0.25 sec
 ARIMA(0,0,3)(1,1,2)[7] intercept   : AIC=1924.801, Time=2.02 sec
 ARIMA(1,0,3)(0,1,1)[7] intercept   : AIC=inf, Time=1.07 sec
 ARIMA(0,0,3)(0,1,1)[7]             : AIC=1921.397, Time=0.44 sec
 ARIMA(0,0,3)(0,1,0)[7]             : AIC=2037.628, Time=0.08 sec
 ARIMA(0,0,3)(1,1,1)[7]             : AIC=1922.965, Time=0.37 sec
 ARIMA(0,0,3)(0,1,2)[7]             : AIC=1923.037, Time=0.60 sec
 ARIMA(0,0,3)(1,1,0)[7]             : AIC=1967.312, Time=0.12 sec
 ARIMA(0,0,3)(1,1,2)[7]             : AIC=inf, Time=1.60 sec
 ARIMA(0,0,2)(0,1,1)[7]             : AIC=1924.592, Time=0.18 sec
 ARIMA(1,0,3)(0,1,1)[7]             : AIC=inf, Time=0.73 sec
 ARIMA(1,0,2)(0,1,1)[7]             : AIC=inf, Time=0.64 sec

Best model:  ARIMA(0,0,3)(0,1,1)[7]          
Total fit time: 17.101 seconds
</pre></div>
</div>
</div>
</div>
<section id="id6">
<h5><strong>Selecting the best model</strong><a class="headerlink" href="#id6" title="Link to this heading">#</a></h5>
<p>Given the previous results, in this section we get the best model, that is, the one with the least inner error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">inner_scores_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">best_model_CV</span> <span class="o">=</span> <span class="n">model_names</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">inner_scores_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">model_names</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">),</span> 
                     <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_model_CV</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Model Selection - Daily Humidity (%) </span><span class="se">\n\n</span><span class="s1"> </span><span class="si">{</span><span class="n">n_splits</span><span class="si">}</span><span class="s1"> Fold CV - Test window </span><span class="si">{</span><span class="n">test_window</span><span class="si">}</span><span class="s1"> days&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The best model according to cross validation is&#39;</span><span class="p">,</span> <span class="n">best_model_CV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/aa809a00be2168654d6ba93e9d36829e46a2369affb949be11d4b9f3a93837ec.png" src="_images/aa809a00be2168654d6ba93e9d36829e46a2369affb949be11d4b9f3a93837ec.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The best model according to cross validation is Linear Regression (lag=40)
</pre></div>
</div>
</div>
</div>
<p>According to cross validation with a test window fo 15 days, the best model for forecasting the humidity in Jena is the Linear Regression  algorithm with 40 lags.</p>
<p>We can see again that the lags have a crucial influence in the forecasting results.</p>
</section>
<section id="id7">
<h5><strong>Predictive visualization</strong><a class="headerlink" href="#id7" title="Link to this heading">#</a></h5>
<p>In this section we are going to plot the K-Fold cross validation process applied above for some of the models, just for getting more insight of how it works, and how dependent are the forecast on the train-validate partitions (namely, on the folds).</p>
<ul class="simple">
<li><p>SARIMA <span class="math notranslate nohighlight">\((p=1, d=0, q=0)\times(P=1, D=1, Q=0)_{s=7}\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimator</span> <span class="o">=</span> <span class="n">sarima</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sarima</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

<span class="n">KFold_time_series_plot</span><span class="p">(</span><span class="n">n_cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">estimator</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span> 
                       <span class="n">X</span><span class="o">=</span><span class="n">X_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
                       <span class="n">true_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">pred_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Forecasting Daily Avg. Humidity (%) - Forecast window of </span><span class="si">{</span><span class="n">forecast_window</span><span class="si">}</span><span class="s2"> days - </span><span class="si">{</span><span class="n">n_splits</span><span class="si">}</span><span class="s2"> Fold CV - MAE = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                       <span class="n">hspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">subtitles_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">title_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">xticks_rotation</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> 
                       <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.05</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fold&#39;s size: 290. Train size: 275. Test size: 15
</pre></div>
</div>
<img alt="_images/4a3978134db27f4e02e3346c55f6ea78b8ea5fa0d4fdf2d1eed0bb769c01487c.png" src="_images/4a3978134db27f4e02e3346c55f6ea78b8ea5fa0d4fdf2d1eed0bb769c01487c.png" />
</div>
</div>
<ul class="simple">
<li><p>Linear regression with 40 lags</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimator</span> <span class="o">=</span> <span class="n">linear_regression</span>
<span class="n">lag</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Linear Regression (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span>

<span class="n">KFold_time_series_plot</span><span class="p">(</span><span class="n">n_cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">estimator</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span>  <span class="n">score</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">,</span>
                       <span class="n">X</span><span class="o">=</span><span class="n">X_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
                       <span class="n">true_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">pred_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Forecasting Daily Avg. Humidity (%) - Forecast window of </span><span class="si">{</span><span class="n">forecast_window</span><span class="si">}</span><span class="s2"> days - </span><span class="si">{</span><span class="n">n_splits</span><span class="si">}</span><span class="s2"> Fold CV - MAE = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                       <span class="n">hspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">subtitles_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">title_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">xticks_rotation</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> 
                       <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.05</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fold&#39;s size: 286. Train size: 271. Test size: 15
</pre></div>
</div>
<img alt="_images/dafd05141326a670ce248edc642dc15c5a2fb86eff800886d9972c23380607e1.png" src="_images/dafd05141326a670ce248edc642dc15c5a2fb86eff800886d9972c23380607e1.png" />
</div>
</div>
</section>
<section id="id8">
<h5><strong>Estimation of future performance</strong><a class="headerlink" href="#id8" title="Link to this heading">#</a></h5>
<p>We estimate the future performance of the best model according to KFold Cross Validation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_model_CV</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Linear Regression (lag=40)&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">linear_regression</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">])</span>
<span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">linear_regression</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">test_window</span><span class="p">)</span>
<span class="n">estimation_future_performance</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">Y_test_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">])</span>
<span class="n">estimation_future_performance</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.438584620069256
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="wind-speed-wv">
<h3><strong>Wind Speed (<code class="docutils literal notranslate"><span class="pre">wv</span></code>)</strong><a class="headerlink" href="#wind-speed-wv" title="Link to this heading">#</a></h3>
<section id="id9">
<h4><strong>Cross Validation</strong><a class="headerlink" href="#id9" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_splits</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">series</span> <span class="o">=</span> <span class="s1">&#39;wv&#39;</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Computing inner score by K-Fold CV for <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> implementation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">st_models</span><span class="p">[</span><span class="n">series</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">st_models</span><span class="p">[</span><span class="n">series</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">scores</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">KFold_score_time_series</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> 
                                          <span class="n">X</span><span class="o">=</span><span class="n">X_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> 
                                          <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> 
                                          <span class="n">scoring</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">)</span>                                    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SARIMA(p=1)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(p=2)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(p=1, q=1)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(p=1, q=2)
Fold&#39;s size: 290. Train size: 275. Test size: 15
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SARIMA(p=2, q=1)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SARIMA(p=2, q=2)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SimpleExpSmooth(smoothing_level=0.05)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SimpleExpSmooth(smoothing_level=0.5)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SimpleExpSmooth(smoothing_level=0.8)
Fold&#39;s size: 290. Train size: 275. Test size: 15
SimpleExpSmooth(smoothing_level=1.5)
Fold&#39;s size: 290. Train size: 275. Test size: 15
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Computing inner score by K-Fold CV for <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> implementation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lags_grid</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sk_models</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">sk_models</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">scores</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">KFold_score_time_series</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> 
                                            <span class="n">X</span><span class="o">=</span><span class="n">X_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> 
                                            <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> 
                                            <span class="n">scoring</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">)</span>                                    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
Linear Regression
Fold&#39;s size: 290. Train size: 275. Test size: 15
knn
Fold&#39;s size: 290. Train size: 275. Test size: 15
2
Linear Regression
Fold&#39;s size: 290. Train size: 275. Test size: 15
knn
Fold&#39;s size: 290. Train size: 275. Test size: 15
3
Linear Regression
Fold&#39;s size: 290. Train size: 275. Test size: 15
knn
Fold&#39;s size: 290. Train size: 275. Test size: 15
7
Linear Regression
Fold&#39;s size: 289. Train size: 274. Test size: 15
knn
Fold&#39;s size: 289. Train size: 274. Test size: 15
10
Linear Regression
Fold&#39;s size: 289. Train size: 274. Test size: 15
knn
Fold&#39;s size: 289. Train size: 274. Test size: 15
20
Linear Regression
Fold&#39;s size: 288. Train size: 273. Test size: 15
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>knn
Fold&#39;s size: 288. Train size: 273. Test size: 15
30
Linear Regression
Fold&#39;s size: 287. Train size: 272. Test size: 15
knn
Fold&#39;s size: 287. Train size: 272. Test size: 15
40
Linear Regression
Fold&#39;s size: 286. Train size: 271. Test size: 15
knn
Fold&#39;s size: 286. Train size: 271. Test size: 15
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Computing inner score by K-Fold CV for <code class="docutils literal notranslate"><span class="pre">pdmarima</span></code> implementation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Auto SARIMA&#39;</span>

<span class="n">auto_sarima</span> <span class="o">=</span> <span class="n">autoSARIMA</span><span class="p">(</span><span class="n">seasonal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                         <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">scores</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">KFold_score_time_series</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">auto_sarima</span><span class="p">,</span> 
                                          <span class="n">X</span><span class="o">=</span><span class="n">X_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> 
                                          <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> 
                                          <span class="n">scoring</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">)</span>                                    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fold&#39;s size: 290. Train size: 275. Test size: 15
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.28 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=815.877, Time=0.01 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=697.372, Time=0.13 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.21 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=813.894, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=763.906, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=678.813, Time=0.31 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=0.72 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.27 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=726.068, Time=0.28 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=676.668, Time=0.29 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=693.946, Time=0.15 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=0.73 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.43 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=677.502, Time=0.34 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=677.559, Time=0.52 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=675.713, Time=0.32 sec
 ARIMA(1,0,1)(1,1,0)[7] intercept   : AIC=691.406, Time=0.14 sec
 ARIMA(1,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=0.81 sec
 ARIMA(1,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.46 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=674.638, Time=0.18 sec
 ARIMA(0,0,1)(1,1,0)[7] intercept   : AIC=689.527, Time=0.10 sec
 ARIMA(0,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=0.50 sec
 ARIMA(0,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.33 sec
 ARIMA(0,0,2)(2,1,0)[7] intercept   : AIC=675.807, Time=0.23 sec
 ARIMA(1,0,2)(2,1,0)[7] intercept   : AIC=677.535, Time=0.87 sec
 ARIMA(0,0,1)(2,1,0)[7]             : AIC=672.662, Time=0.11 sec
 ARIMA(0,0,1)(1,1,0)[7]             : AIC=687.543, Time=0.05 sec
 ARIMA(0,0,1)(2,1,1)[7]             : AIC=inf, Time=0.37 sec
 ARIMA(0,0,1)(1,1,1)[7]             : AIC=inf, Time=0.20 sec
 ARIMA(0,0,0)(2,1,0)[7]             : AIC=724.081, Time=0.05 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=673.740, Time=0.13 sec
 ARIMA(0,0,2)(2,1,0)[7]             : AIC=673.833, Time=0.10 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=676.846, Time=0.11 sec
 ARIMA(1,0,2)(2,1,0)[7]             : AIC=675.564, Time=0.45 sec

Best model:  ARIMA(0,0,1)(2,1,0)[7]          
Total fit time: 10.222 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.43 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=936.839, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=819.712, Time=0.08 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.22 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=934.863, Time=0.02 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=904.989, Time=0.00 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=807.182, Time=0.22 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.28 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.48 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=847.684, Time=0.15 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=807.577, Time=0.23 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=807.620, Time=0.24 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=807.660, Time=0.15 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=809.569, Time=0.52 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=805.186, Time=0.08 sec
 ARIMA(1,0,0)(1,1,0)[7]             : AIC=817.727, Time=0.04 sec
 ARIMA(1,0,0)(2,1,1)[7]             : AIC=inf, Time=0.66 sec
 ARIMA(1,0,0)(1,1,1)[7]             : AIC=inf, Time=0.17 sec
 ARIMA(0,0,0)(2,1,0)[7]             : AIC=845.685, Time=0.05 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=805.580, Time=0.10 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=805.624, Time=0.11 sec
 ARIMA(0,0,1)(2,1,0)[7]             : AIC=805.663, Time=0.10 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=807.572, Time=0.23 sec

Best model:  ARIMA(1,0,0)(2,1,0)[7]          
Total fit time: 5.566 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.45 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=933.805, Time=0.02 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=828.911, Time=0.08 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.44 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=931.865, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=879.426, Time=0.03 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=795.084, Time=0.17 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=0.88 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.57 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=855.098, Time=0.28 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=790.186, Time=0.22 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=829.584, Time=0.11 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.66 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.58 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=790.395, Time=0.27 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=inf, Time=1.75 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=792.312, Time=0.31 sec
 ARIMA(3,0,1)(2,1,0)[7] intercept   : AIC=792.111, Time=0.83 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=788.262, Time=0.14 sec
 ARIMA(2,0,0)(1,1,0)[7]             : AIC=827.622, Time=0.05 sec
 ARIMA(2,0,0)(2,1,1)[7]             : AIC=inf, Time=1.12 sec
 ARIMA(2,0,0)(1,1,1)[7]             : AIC=inf, Time=0.46 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=793.133, Time=0.08 sec
 ARIMA(3,0,0)(2,1,0)[7]             : AIC=788.486, Time=0.11 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=inf, Time=1.01 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=790.375, Time=0.09 sec
 ARIMA(3,0,1)(2,1,0)[7]             : AIC=790.211, Time=0.47 sec

Best model:  ARIMA(2,0,0)(2,1,0)[7]          
Total fit time: 12.213 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.30 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=929.920, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=808.106, Time=0.08 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.37 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=927.924, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=868.516, Time=0.03 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=774.260, Time=0.24 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.20 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.69 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=850.232, Time=0.30 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=775.736, Time=0.30 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=775.724, Time=0.29 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=787.038, Time=0.21 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=777.722, Time=0.47 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=772.260, Time=0.07 sec
 ARIMA(1,0,0)(1,1,0)[7]             : AIC=806.107, Time=0.05 sec
 ARIMA(1,0,0)(2,1,1)[7]             : AIC=inf, Time=0.32 sec
 ARIMA(1,0,0)(1,1,1)[7]             : AIC=inf, Time=0.20 sec
 ARIMA(0,0,0)(2,1,0)[7]             : AIC=848.232, Time=0.05 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=773.736, Time=0.09 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=773.724, Time=0.12 sec
 ARIMA(0,0,1)(2,1,0)[7]             : AIC=785.039, Time=0.07 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=775.722, Time=0.20 sec

Best model:  ARIMA(1,0,0)(2,1,0)[7]          
Total fit time: 5.650 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.46 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=796.942, Time=0.02 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=686.577, Time=0.11 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.48 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=794.986, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=757.072, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=662.798, Time=0.22 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.04 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.60 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=696.745, Time=0.25 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=661.960, Time=0.33 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=687.191, Time=0.13 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.59 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.80 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=663.850, Time=0.33 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=663.911, Time=0.50 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=662.127, Time=0.31 sec
 ARIMA(3,0,1)(2,1,0)[7] intercept   : AIC=665.723, Time=0.75 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=660.123, Time=0.12 sec
 ARIMA(2,0,0)(1,1,0)[7]             : AIC=685.272, Time=0.06 sec
 ARIMA(2,0,0)(2,1,1)[7]             : AIC=inf, Time=0.75 sec
 ARIMA(2,0,0)(1,1,1)[7]             : AIC=inf, Time=0.66 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=660.948, Time=0.08 sec
 ARIMA(3,0,0)(2,1,0)[7]             : AIC=662.008, Time=0.15 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=662.071, Time=0.22 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=660.283, Time=0.16 sec
 ARIMA(3,0,1)(2,1,0)[7]             : AIC=663.875, Time=0.37 sec

Best model:  ARIMA(2,0,0)(2,1,0)[7]          
Total fit time: 10.516 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.39 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=885.632, Time=0.01 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=749.853, Time=0.10 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.65 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=884.211, Time=0.02 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=793.589, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=716.133, Time=0.22 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.11 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.64 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=810.719, Time=0.33 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=716.517, Time=0.30 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=716.817, Time=0.32 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=732.024, Time=0.20 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=inf, Time=1.19 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=714.371, Time=0.12 sec
 ARIMA(1,0,0)(1,1,0)[7]             : AIC=748.119, Time=0.05 sec
 ARIMA(1,0,0)(2,1,1)[7]             : AIC=663.125, Time=0.35 sec
 ARIMA(1,0,0)(1,1,1)[7]             : AIC=inf, Time=0.18 sec
 ARIMA(1,0,0)(2,1,2)[7]             : AIC=665.125, Time=0.53 sec
 ARIMA(1,0,0)(1,1,2)[7]             : AIC=inf, Time=0.46 sec
 ARIMA(0,0,0)(2,1,1)[7]             : AIC=753.947, Time=0.18 sec
 ARIMA(2,0,0)(2,1,1)[7]             : AIC=665.058, Time=0.39 sec
 ARIMA(1,0,1)(2,1,1)[7]             : AIC=665.061, Time=0.42 sec
 ARIMA(0,0,1)(2,1,1)[7]             : AIC=679.937, Time=0.28 sec
 ARIMA(2,0,1)(2,1,1)[7]             : AIC=666.693, Time=0.92 sec

Best model:  ARIMA(1,0,0)(2,1,1)[7]          
Total fit time: 9.370 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.43 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=895.395, Time=0.01 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=790.881, Time=0.08 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.36 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=893.396, Time=0.00 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=840.900, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=778.172, Time=0.20 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.11 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.73 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=852.297, Time=0.26 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=780.088, Time=0.30 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=780.068, Time=0.36 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=791.831, Time=0.21 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=781.833, Time=0.95 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=776.178, Time=0.10 sec
 ARIMA(1,0,0)(1,1,0)[7]             : AIC=788.881, Time=0.07 sec
 ARIMA(1,0,0)(2,1,1)[7]             : AIC=inf, Time=0.61 sec
 ARIMA(1,0,0)(1,1,1)[7]             : AIC=inf, Time=0.40 sec
 ARIMA(0,0,0)(2,1,0)[7]             : AIC=850.331, Time=0.05 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=778.094, Time=0.12 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=778.073, Time=0.13 sec
 ARIMA(0,0,1)(2,1,0)[7]             : AIC=789.847, Time=0.08 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=779.839, Time=0.37 sec

Best model:  ARIMA(1,0,0)(2,1,0)[7]          
Total fit time: 6.947 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.37 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=1002.354, Time=0.02 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=864.975, Time=0.09 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.38 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=1000.398, Time=0.02 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=923.868, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=822.141, Time=0.17 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.20 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.68 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=881.561, Time=0.20 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=822.543, Time=0.25 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=823.155, Time=0.28 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=839.758, Time=0.22 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=823.080, Time=0.52 sec
 ARIMA(1,0,0)(2,1,0)[7]             : AIC=820.169, Time=0.08 sec
 ARIMA(1,0,0)(1,1,0)[7]             : AIC=863.006, Time=0.05 sec
 ARIMA(1,0,0)(2,1,1)[7]             : AIC=inf, Time=0.67 sec
 ARIMA(1,0,0)(1,1,1)[7]             : AIC=inf, Time=0.40 sec
 ARIMA(0,0,0)(2,1,0)[7]             : AIC=879.619, Time=0.07 sec
 ARIMA(2,0,0)(2,1,0)[7]             : AIC=820.569, Time=0.13 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=821.181, Time=0.12 sec
 ARIMA(0,0,1)(2,1,0)[7]             : AIC=837.799, Time=0.11 sec
 ARIMA(2,0,1)(2,1,0)[7]             : AIC=821.105, Time=0.22 sec

Best model:  ARIMA(1,0,0)(2,1,0)[7]          
Total fit time: 6.252 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.43 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=977.869, Time=0.00 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=860.897, Time=0.10 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=inf, Time=0.49 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=976.092, Time=0.01 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=917.567, Time=0.02 sec
 ARIMA(1,0,0)(2,1,0)[7] intercept   : AIC=839.906, Time=0.15 sec
 ARIMA(1,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=0.87 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.55 sec
 ARIMA(0,0,0)(2,1,0)[7] intercept   : AIC=899.401, Time=0.23 sec
 ARIMA(2,0,0)(2,1,0)[7] intercept   : AIC=837.229, Time=0.23 sec
 ARIMA(2,0,0)(1,1,0)[7] intercept   : AIC=856.487, Time=0.10 sec
 ARIMA(2,0,0)(2,1,1)[7] intercept   : AIC=inf, Time=1.37 sec
 ARIMA(2,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.65 sec
 ARIMA(3,0,0)(2,1,0)[7] intercept   : AIC=838.816, Time=0.32 sec
 ARIMA(2,0,1)(2,1,0)[7] intercept   : AIC=839.007, Time=0.48 sec
 ARIMA(1,0,1)(2,1,0)[7] intercept   : AIC=837.164, Time=0.30 sec
 ARIMA(1,0,1)(1,1,0)[7] intercept   : AIC=857.148, Time=0.17 sec
 ARIMA(1,0,1)(2,1,1)[7] intercept   : AIC=inf, Time=1.67 sec
 ARIMA(1,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.64 sec
 ARIMA(0,0,1)(2,1,0)[7] intercept   : AIC=839.294, Time=0.20 sec
 ARIMA(1,0,2)(2,1,0)[7] intercept   : AIC=838.385, Time=0.72 sec
 ARIMA(0,0,2)(2,1,0)[7] intercept   : AIC=836.696, Time=0.23 sec
 ARIMA(0,0,2)(1,1,0)[7] intercept   : AIC=856.097, Time=0.10 sec
 ARIMA(0,0,2)(2,1,1)[7] intercept   : AIC=inf, Time=0.92 sec
 ARIMA(0,0,2)(1,1,1)[7] intercept   : AIC=inf, Time=0.77 sec
 ARIMA(0,0,3)(2,1,0)[7] intercept   : AIC=838.598, Time=0.25 sec
 ARIMA(1,0,3)(2,1,0)[7] intercept   : AIC=839.745, Time=1.07 sec
 ARIMA(0,0,2)(2,1,0)[7]             : AIC=835.006, Time=0.11 sec
 ARIMA(0,0,2)(1,1,0)[7]             : AIC=854.291, Time=0.07 sec
 ARIMA(0,0,2)(2,1,1)[7]             : AIC=inf, Time=0.62 sec
 ARIMA(0,0,2)(1,1,1)[7]             : AIC=inf, Time=0.33 sec
 ARIMA(0,0,1)(2,1,0)[7]             : AIC=837.717, Time=0.09 sec
 ARIMA(1,0,2)(2,1,0)[7]             : AIC=836.743, Time=0.34 sec
 ARIMA(0,0,3)(2,1,0)[7]             : AIC=836.921, Time=0.09 sec
 ARIMA(1,0,1)(2,1,0)[7]             : AIC=835.458, Time=0.13 sec
 ARIMA(1,0,3)(2,1,0)[7]             : AIC=838.068, Time=0.45 sec

Best model:  ARIMA(0,0,2)(2,1,0)[7]          
Total fit time: 15.317 seconds
Performing stepwise search to minimize aic
 ARIMA(0,0,0)(1,1,1)[7] intercept   : AIC=693.362, Time=0.22 sec
 ARIMA(0,0,0)(0,1,0)[7] intercept   : AIC=838.120, Time=0.02 sec
 ARIMA(1,0,0)(1,1,0)[7] intercept   : AIC=697.102, Time=0.12 sec
 ARIMA(0,0,1)(0,1,1)[7] intercept   : AIC=659.254, Time=0.17 sec
 ARIMA(0,0,0)(0,1,0)[7]             : AIC=836.266, Time=0.01 sec
 ARIMA(0,0,1)(0,1,0)[7] intercept   : AIC=786.790, Time=0.03 sec
 ARIMA(0,0,1)(1,1,1)[7] intercept   : AIC=inf, Time=0.32 sec
 ARIMA(0,0,1)(0,1,2)[7] intercept   : AIC=660.652, Time=0.40 sec
 ARIMA(0,0,1)(1,1,0)[7] intercept   : AIC=703.535, Time=0.12 sec
 ARIMA(0,0,1)(1,1,2)[7] intercept   : AIC=661.087, Time=0.62 sec
 ARIMA(0,0,0)(0,1,1)[7] intercept   : AIC=691.365, Time=0.13 sec
 ARIMA(1,0,1)(0,1,1)[7] intercept   : AIC=651.772, Time=0.59 sec
 ARIMA(1,0,1)(0,1,0)[7] intercept   : AIC=776.733, Time=0.05 sec
 ARIMA(1,0,1)(1,1,1)[7] intercept   : AIC=653.021, Time=0.45 sec
 ARIMA(1,0,1)(0,1,2)[7] intercept   : AIC=653.193, Time=0.65 sec
 ARIMA(1,0,1)(1,1,0)[7] intercept   : AIC=699.023, Time=0.17 sec
 ARIMA(1,0,1)(1,1,2)[7] intercept   : AIC=654.398, Time=1.05 sec
 ARIMA(1,0,0)(0,1,1)[7] intercept   : AIC=650.405, Time=0.25 sec
 ARIMA(1,0,0)(0,1,0)[7] intercept   : AIC=774.850, Time=0.02 sec
 ARIMA(1,0,0)(1,1,1)[7] intercept   : AIC=inf, Time=0.28 sec
 ARIMA(1,0,0)(0,1,2)[7] intercept   : AIC=651.635, Time=0.44 sec
 ARIMA(1,0,0)(1,1,2)[7] intercept   : AIC=653.122, Time=0.71 sec
 ARIMA(2,0,0)(0,1,1)[7] intercept   : AIC=651.698, Time=0.23 sec
 ARIMA(2,0,1)(0,1,1)[7] intercept   : AIC=653.118, Time=0.48 sec
 ARIMA(1,0,0)(0,1,1)[7]             : AIC=649.900, Time=0.10 sec
 ARIMA(1,0,0)(0,1,0)[7]             : AIC=772.959, Time=0.00 sec
 ARIMA(1,0,0)(1,1,1)[7]             : AIC=651.492, Time=0.15 sec
 ARIMA(1,0,0)(0,1,2)[7]             : AIC=651.574, Time=0.22 sec
 ARIMA(1,0,0)(1,1,0)[7]             : AIC=695.239, Time=0.05 sec
 ARIMA(1,0,0)(1,1,2)[7]             : AIC=652.415, Time=0.47 sec
 ARIMA(0,0,0)(0,1,1)[7]             : AIC=692.853, Time=0.06 sec
 ARIMA(2,0,0)(0,1,1)[7]             : AIC=651.069, Time=0.17 sec
 ARIMA(1,0,1)(0,1,1)[7]             : AIC=651.142, Time=0.17 sec
 ARIMA(0,0,1)(0,1,1)[7]             : AIC=659.485, Time=0.11 sec
 ARIMA(2,0,1)(0,1,1)[7]             : AIC=652.497, Time=0.28 sec

Best model:  ARIMA(1,0,0)(0,1,1)[7]          
Total fit time: 9.315 seconds
</pre></div>
</div>
</div>
</div>
<section id="id10">
<h5><strong>Selecting the best model</strong><a class="headerlink" href="#id10" title="Link to this heading">#</a></h5>
<p>Given the previous results, in this section we get the best model, that is, the one with the least inner error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">inner_scores_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">best_model_CV</span> <span class="o">=</span> <span class="n">model_names</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">inner_scores_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">model_names</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">),</span> 
                     <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_model_CV</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Model Selection - Daily Wind Speed (m/s) </span><span class="se">\n\n</span><span class="s1"> </span><span class="si">{</span><span class="n">n_splits</span><span class="si">}</span><span class="s1"> Fold CV - Test window </span><span class="si">{</span><span class="n">test_window</span><span class="si">}</span><span class="s1"> days&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The best model according to cross validation is&#39;</span><span class="p">,</span> <span class="n">best_model_CV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/942cdaa86c9ba86b5a78ec341304dc8504d4eb4b385e6a555e450558740f0470.png" src="_images/942cdaa86c9ba86b5a78ec341304dc8504d4eb4b385e6a555e450558740f0470.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The best model according to cross validation is SARIMA(p=2, q=1)
</pre></div>
</div>
</div>
</div>
<p>According to cross validation with a test window fo 15 days, the best model for forecasting the wind speed in Jena is the SARIMA <span class="math notranslate nohighlight">\(\small{(p=2, d=0, q=1)\times(P=0, D=0, Q=0)}_{s=0}\)</span></p>
<p>We can see again that the lags have an important influence in the forecasting results.</p>
</section>
<section id="id11">
<h5><strong>Predictive visualization</strong><a class="headerlink" href="#id11" title="Link to this heading">#</a></h5>
<ul class="simple">
<li><p>SARIMA <span class="math notranslate nohighlight">\((p=2, d=0, q=1)\times(P=0, D=0, Q=0)_{s=0}\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimator</span> <span class="o">=</span> <span class="n">sarima</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sarima</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span>

<span class="n">KFold_time_series_plot</span><span class="p">(</span><span class="n">n_cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">estimator</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span> 
                       <span class="n">X</span><span class="o">=</span><span class="n">X_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_st</span><span class="p">[</span><span class="n">series</span><span class="p">],</span> <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
                       <span class="n">true_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">pred_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Forecasting Daily Avg. Wind Speed (m/s) - Forecast window of </span><span class="si">{</span><span class="n">forecast_window</span><span class="si">}</span><span class="s2"> days - </span><span class="si">{</span><span class="n">n_splits</span><span class="si">}</span><span class="s2"> Fold CV - MAE = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                       <span class="n">hspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">subtitles_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">title_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">xticks_rotation</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> 
                       <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.05</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fold&#39;s size: 290. Train size: 275. Test size: 15
</pre></div>
</div>
<img alt="_images/65d30ae53fe4fdfffd41b0bf1c1e6ade50fa6339b9cb746f4a0c1ac16b95f1c5.png" src="_images/65d30ae53fe4fdfffd41b0bf1c1e6ade50fa6339b9cb746f4a0c1ac16b95f1c5.png" />
</div>
</div>
<ul class="simple">
<li><p>Linear regression with 3 lags</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimator</span> <span class="o">=</span> <span class="n">linear_regression</span>
<span class="n">lag</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Linear Regression (lag=</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">)&#39;</span>

<span class="n">KFold_time_series_plot</span><span class="p">(</span><span class="n">n_cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">estimator</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span>  <span class="n">score</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">,</span>
                       <span class="n">X</span><span class="o">=</span><span class="n">X_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_window</span><span class="o">=</span><span class="n">test_window</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
                       <span class="n">true_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">pred_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Forecasting Daily Avg. Wind Speed (m/s) - Forecast window of </span><span class="si">{</span><span class="n">forecast_window</span><span class="si">}</span><span class="s2"> days - </span><span class="si">{</span><span class="n">n_splits</span><span class="si">}</span><span class="s2"> Fold CV - MAE = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                       <span class="n">hspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">subtitles_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">title_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">xticks_rotation</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> 
                       <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.05</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fold&#39;s size: 290. Train size: 275. Test size: 15
</pre></div>
</div>
<img alt="_images/e51990b588c7dc3e9a84a490850c9176e31229db3a405ef5b5112a1ec1278b60.png" src="_images/e51990b588c7dc3e9a84a490850c9176e31229db3a405ef5b5112a1ec1278b60.png" />
</div>
</div>
</section>
<section id="id12">
<h5><strong>Estimation of future performance</strong><a class="headerlink" href="#id12" title="Link to this heading">#</a></h5>
<p>We estimate the future performance of the best model according to KFold Cross Validation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_model_CV</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;SARIMA(p=2, q=1)&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">linear_regression</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">])</span>
<span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">linear_regression</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">test_window</span><span class="p">)</span>
<span class="n">estimation_future_performance</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">Y_test_sk</span><span class="p">[</span><span class="n">series</span><span class="p">][</span><span class="n">lag</span><span class="p">])</span>
<span class="n">estimation_future_performance</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8715102370962747
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="conclusions">
<h3><strong>Conclusions</strong><a class="headerlink" href="#conclusions" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>In this project we have look for a good model for forecasting the temperature, humidity and wind speed of an specific region of Germany. We have done that focus on statistical techniques, like the family of models SARIMA, exponential smoothing, KNN and linear regression.</p></li>
<li><p>We have been focus on the manual SARIMA, that is, in the specification of the parameters of this model in a manual way, by exploring and analyzing the auto correlations of the series and their trend and seasonality.</p></li>
<li><p>We have also implemented some code oriented to apply the so popular and well developed Machine Learning library <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> to time series. How powerful this could be will be show in the next project with more details. This developments are contained in  <code class="docutils literal notranslate"><span class="pre">PyTS.py</span></code>, and will be improve for the next project.</p></li>
<li><p>In addition, we have analyzed the two already classic ways of comparing models in time series, simple validation and cross validation. And we had reach the conclusion that the second one is a much more reliable option.</p></li>
<li><p>At the end we have obtained three models for forecasting our variables, the ones are not too bad, but can be improved with a more exhaustive search, based on ML model and techniques, as we will see in the next project. So, we consider this project as a first step for a better upcoming project (in term of expected results).</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Forecasting Temperature</p>
      </div>
    </a>
    <a class="right-next"
       href="Forecasting_Approaches.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><strong>Time Series Forecasting: Machine Learning Approach</strong></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data"><strong>Data</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conceptual-description"><strong>Conceptual description</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-the-data"><strong>Preprocessing the data</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#yearly-temperature-time-series"><strong>yearly temperature time series</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting"><strong>Plotting</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monthly-temperature-time-series"><strong>Monthly temperature time series</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><strong>Plotting</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#daily-time-series"><strong>Daily time series</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><strong>Plotting</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forecasting-daily-temperature-humidity-and-wind-speed"><strong>Forecasting Daily Temperature, Humidity and Wind Speed</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-and-predictors-lags"><strong>Response and Predictors (lags)</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#characterizing-sarima-models"><strong>Characterizing SARIMA models</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series-decomposition"><strong>Time series decomposition</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-correlation-plots"><strong>Auto-correlation Plots</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#regular-part-p-q"><strong>Regular part <span class="math notranslate nohighlight">\((p,q)\)</span></strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-part-p-q"><strong>Seasonal part <span class="math notranslate nohighlight">\((P,Q)\)</span></strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#augmented-dickey-fuller-test"><strong>Augmented Dickey Fuller Test</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#final-specification"><strong>Final specification</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-the-models"><strong>Specifying the models</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series-train-test-split"><strong>Time Series Train-Test split</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-t"><strong>Temperature (<code class="docutils literal notranslate"><span class="pre">T</span></code>)</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-validation"><strong>Simple Validation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#predictive-visualization"><strong>Predictive visualization</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-the-best-model"><strong>Selecting the best model</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-validation"><strong>Cross Validation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id3"><strong>Selecting the best model</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id4"><strong>Predictive visualization</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-future-performance"><strong>Estimation of future performance</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#humidity-rh"><strong>Humidity (<code class="docutils literal notranslate"><span class="pre">rh</span></code>)</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5"><strong>Cross Validation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id6"><strong>Selecting the best model</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id7"><strong>Predictive visualization</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id8"><strong>Estimation of future performance</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wind-speed-wv"><strong>Wind Speed (<code class="docutils literal notranslate"><span class="pre">wv</span></code>)</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9"><strong>Cross Validation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id10"><strong>Selecting the best model</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id11"><strong>Predictive visualization</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id12"><strong>Estimation of future performance</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions"><strong>Conclusions</strong></a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Fabio Scielzo Ortiz
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>